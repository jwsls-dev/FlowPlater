var DataExtractorPlugin=function(){"use strict";const s={level:1,levels:{ERROR:0,WARN:1,INFO:2,DEBUG:3},log:function(e){this.level},error:function(...e){this.log(this.levels.ERROR,...e)},warn:function(...e){this.log(this.levels.WARN,...e)},info:function(...e){this.log(this.levels.INFO,...e)},debug:function(...e){this.log(this.levels.DEBUG,...e)}},F={INHERITABLE_ATTRIBUTES:{"hx-":["boost","push-url","select","select-oob","swap","target","vals","confirm","disable","disabled-elt","encoding","ext","headers","include","indicator","params","prompt","replace-url","request","sync","vars"],"fp-":["prepend","append","persist","target"]},_prefixes(){return Object.keys(this.INHERITABLE_ATTRIBUTES)},_normalizeAttributeName(e){return e.replace(/^(hx-|fp-)/,"").replace(/^data-/,"")},_getAllAttributeNames(e){var t=this._normalizeAttributeName(e),r=[];for(const a of this._prefixes())r.push(""+a+t),r.push("data-"+a+t);return r},_getRawAttribute(e,t,r=null){for(const n of this._getAllAttributeNames(t)){var a=e.getAttribute(n);if(null!==a)return a}return r},_hasAttribute(t,e){return this._getAllAttributeNames(e).some(e=>t.hasAttribute(e))},findMatchingElements(e,t=null,r=!0,a=document,n=!0,l=!1){var i=this._getAllAttributeNames(e);let s=i.map(e=>`[${e}]`).join(",");if(null!=t){const o=r?`="${t}"`:`*="${t}"`;s=i.map(e=>`[${e}${o}]`).join(",")}i=Array.from(a.querySelectorAll(s));return n&&a instanceof Element&&(null===(n=this._getRawAttribute(a,e))||null!=t&&(r?n!==t:!n.includes(t))||i.unshift(a)),null!=t&&l?i[0]:i},findClosestParent(e,t,r=null,a=!0){if(!e)return s.error("Attribute name is required"),null;if(!t)return s.error("Element is required to find closest parent ("+e+")"),null;var e=this._normalizeAttributeName(e),n=this._getAllAttributeNames(e);let l=n.map(e=>`[${e}]`).join(",");if(null!=r){const i=a?`="${r}"`:`*="${r}"`;l=n.map(e=>`[${e}${i}]`).join(",")}a=t.closest(l);if(a&&this.isInheritable(e)){r=this._getRawAttribute(a,"disinherit");if(r&&("*"===r||r.split(" ").includes(e)))return null}return a},getElementWithAttribute(e,t=document,r=!0){return r&&t instanceof Element&&this._hasAttribute(t,e)?t:(r=this._getAllAttributeNames(e).map(e=>`[${e}]`).join(","),t.querySelector(r))},_parentElement(e){var t=e.parentElement;return!t&&e.parentNode instanceof ShadowRoot?e.parentNode:t},_getRootNode(e,t=!1){return e.getRootNode?e.getRootNode({composed:t}):document},_getClosestMatch(e,t){for(;e&&!t(e);)e=this._parentElement(e);return e||null},_attributeMatchesNormalizedName(e,t){return e.replace(/^data-/,"").replace(/^hx-/,"").replace(/^fp-/,"")===t},_getAttributeValueWithInheritance(e,t,r){var a=this._getRawAttribute(t,r),n=this._getRawAttribute(t,"disinherit"),l=this._getRawAttribute(t,"inherit");if(e!==t){if(htmx.config.disableInheritance)return l&&("*"===l||l.split(" ").includes(r))?a:null;if(n&&("*"===n||n.split(" ").includes(r)))return"unset"}return a},findInheritedAttribute(t,e){const r=this._normalizeAttributeName(e);let a=null;return this._getClosestMatch(t,e=>{e=this._getAttributeValueWithInheritance(t,e,r);return!!e&&(a=e,!0)}),"unset"===a?null:a},findAttribute(e,t){var r=this._normalizeAttributeName(t);for(const n of this._prefixes()){var a=this._getRawAttribute(e,""+n+r);if(a)return a}return this.findInheritedAttribute(e,r)||null},_validateAttributeName(e){return e?!!this.isInheritable(e)||(s.info(`Attribute ${e} is not inheritable`),!1):(s.error("Attribute name is required"),!1)},addInheritableAttribute(e,t){this.INHERITABLE_ATTRIBUTES[e]||(this.INHERITABLE_ATTRIBUTES[e]=[]),this.INHERITABLE_ATTRIBUTES[e].push(t)},removeInheritableAttribute(e,t){return!!this.INHERITABLE_ATTRIBUTES[e]&&-1!==(t=this.INHERITABLE_ATTRIBUTES[e].indexOf(t))&&(this.INHERITABLE_ATTRIBUTES[e].splice(t,1),!0)},isInheritable(e){e=this._normalizeAttributeName(e);return Object.values(this.INHERITABLE_ATTRIBUTES).flat().includes(e)}};return(e={})=>{const r={name:"data-extractor",enabled:!0,priority:100,version:"1.0.0",dependencies:[],optionalDependencies:[],settings:{debug:!1},description:"Transforms HTML with fp-data attributes into JSON data",author:"FlowPlater Team"};Object.assign(r,e);e={instances:new Map};const R=(r,t=new Set)=>{var a=F._hasAttribute(r,"data"),n=t.has(r);if(!r||!a||n)return FlowPlater.log(FlowPlater.logLevels.DEBUG,"  - Exiting prematurely."),null;t.add(r);let l=null,i=null;var s={};let o=null;var e="fp-data-",u="data-fp-data-";for(const g of r.attributes){let t=null;if(g.name.startsWith(e)?t=g.name.substring(e.length):g.name.startsWith(u)&&(t=g.name.substring(u.length)),t&&"value"!==t){let e=g.value;var c=Number(e);isNaN(c)||""===e.trim()||(e=c),s[t]=e}}a=F._getRawAttribute(r,"data-value",null);if(null!==a)l=a,i="attribute";else{let e=null;if((e=["INPUT","SELECT","TEXTAREA"].includes(r.tagName)?r:e)&&(o={isInput:!0,type:e.type,name:e.name||null,valueAttr:e.value}),null===l&&!o)switch(r.tagName){case"IMG":l={src:r.src,alt:r.alt,width:r.width,height:r.height},i="object";break;case"VIDEO":case"AUDIO":var f=Array.from(r.querySelectorAll("source")).map(e=>({src:e.src,type:e.type}));l={src:r.src,sources:f},i="object";break;case"A":case"BUTTON":l={href:r.href,text:r.textContent?.trim()||"",target:r.target},i="object"}if(null===l&&!o){var n=F.findMatchingElements("data",void 0,!0,r,!1).filter(e=>{let t=e.parentElement;for(;t&&t!==r;){if(F._hasAttribute(t,"data"))return!1;t=t.parentElement}return t===r});if(0<n.length){var d={};let e=!1;var h={};for(const b of n){var p=F._getRawAttribute(b,"data"),m=R(b,t);if(m)if(e=!0,m.inputInfo&&m.inputInfo.name&&("radio"===m.inputInfo.type||"checkbox"===m.inputInfo.type)&&null!==p)h[p]||(h[p]=[]),h[p].push({_isNestedGroupPart:!0,element:b,inputInfo:m.inputInfo,suffixes:m.suffixes});else if(null!==p){let e=m.primaryValue;null!==e&&0<Object.keys(m.suffixes).length?"object"!=typeof e||Array.isArray(e)||null===e?e={value:e,...m.suffixes}:Object.assign(e,m.suffixes):0<Object.keys(m.suffixes).length&&(e=m.suffixes),d.hasOwnProperty(p)?(Array.isArray(d[p])||(d[p]=[d[p]]),d[p].push(e)):d[p]=e}else null===p&&0<Object.keys(m.suffixes).length&&Object.assign(d,m.suffixes)}for(const A in h)d.hasOwnProperty(A)&&FlowPlater.log(FlowPlater.logLevels.WARN,`[DataExtractor] Nested key '${A}' conflicts between regular data and a nested input group. Group data will overwrite.`),d[A]=h[A];e&&(l=d,i="nested")}null!==l||o||""!==(a=Array.from(r.childNodes).filter(e=>e.nodeType===Node.TEXT_NODE).map(e=>e.textContent).join("").trim())&&(l=a,i="text")}}return null!==(l=null===l||"attribute"!==i&&"text"!==i||"string"!=typeof l||(n=Number(l),isNaN(n))||""===l.trim()?l:n)||0!==Object.keys(s).length||o?(o=o||null,{primaryValue:l,suffixes:s,inputInfo:o}):null},l={processHtml(t){FlowPlater.trigger("dataExtractor:beforeProcess",document,{html:t});try{var r=new DOMParser;let e={};e="string"==typeof t?(FlowPlater.log(FlowPlater.logLevels.INFO,"Parsing HTML",t),r.parseFromString(t,"text/html")):t,FlowPlater.log(FlowPlater.logLevels.INFO,"Extracting data from",e.body);var a=n.extractData(e.body)||{};return FlowPlater.log(FlowPlater.logLevels.INFO,"Extracted data",a),FlowPlater.trigger("dataExtractor:processed",document,{html:t,result:a}),a}catch(e){throw FlowPlater.trigger("dataExtractor:error",document,{html:t,error:e}),e}}},n={extractData(r){var t={},a=new Map;const n=new Set;var l,i,s,o,e,u,c=new Map;let f;f=F._hasAttribute(r,"data")?[r]:F.findMatchingElements("data",void 0,!0,r,!1).filter(e=>{let t=e.parentElement;for(;t&&t!==r;){if(F._hasAttribute(t,"data"))return!1;t=t.parentElement}return t===r});const d=t=>{if("object"==typeof t&&null!==t)for(const i in t)if(t.hasOwnProperty(i)){var r=t[i];if(Array.isArray(r)&&0<r.length&&r[0]?._isNestedGroupPart){var a,n=r,l=n[0].inputInfo.type;let e=null;const s={};"radio"===l?(a=n.find(e=>e.element.checked))&&(e=a.inputInfo.valueAttr,Object.assign(s,a.suffixes)):"checkbox"===l&&(0<(a=n.filter(e=>e.element.checked)).length?(e=a.map(e=>e.inputInfo.valueAttr),a.forEach(e=>{for(const t in e.suffixes)s[t]||(s[t]=[]),s[t].push(e.suffixes[t])})):e=[]),t[i]=e;for(const o in s)t.hasOwnProperty(o),t[o]=s[o]}else"object"==typeof r&&d(r)}};for(const T of f)if(!n.has(T)){var h=F._getRawAttribute(T,"data"),p=new Set,m=R(T,p);if(m){if(m.inputInfo&&("radio"===m.inputInfo.type||"checkbox"===m.inputInfo.type)&&m.inputInfo?.name){var g=m.inputInfo.name,b=m.inputInfo.type,A=m.inputInfo.valueAttr,v=T.checked;if(g){c.has(g)||c.set(g,{primaryKey:h,type:b,options:[]}),c.get(g).options.push({element:T,primaryKey:h,valueAttr:A,suffixes:m.suffixes,isChecked:v}),n.add(T),p.forEach(e=>n.add(e));continue}}b=T.querySelector('input[type="radio"][name], input[type="checkbox"][name]');if(b&&!F._hasAttribute(b,"data")){var g=b.name,A=b.type,v=b.value,y=b.checked;c.has(g)||c.set(g,{primaryKey:h,type:A,options:[]}),c.get(g).options.push({element:b,primaryKey:h,valueAttr:v,suffixes:m.suffixes,isChecked:y}),n.add(T),p.forEach(e=>n.add(e))}else{var{primaryValue:y,suffixes:m,inputInfo:E}=m;"object"==typeof y&&null!==y&&d(y);let e=y;null!==(e=E&&E.isInput?(E=T,o=s=i=l=void 0,i=E.name,s=E.type,o=E.getRootNode?E.getRootNode():document,"radio"===s&&i?(l=o.querySelector(`input[type="radio"][name="${CSS.escape(i)}"]:checked`))?l.value:null:"checkbox"===s&&i?1<(l=o.querySelectorAll(`input[type="checkbox"][name="${CSS.escape(i)}"]`)).length?Array.from(l).filter(e=>e.checked).map(e=>e.value):E.checked:"SELECT"===E.tagName&&E.multiple?Array.from(E.selectedOptions).map(e=>e.value):E.value):e)&&void 0!==e&&0<Object.keys(m).length?"object"!=typeof e||Array.isArray(e)||null===e?e={value:e,...m}:Object.assign(e,m):0<Object.keys(m).length&&(e=m),null!==h&&null!==e&&void 0!==e?a.has(h)?(Array.isArray(t[h])||(t[h]=[t[h]]),t[h].push(e)):(a.set(h,!0),t[h]=e):null!==e&&void 0!==e&&"object"==typeof e&&Object.assign(t,e),n.add(T),p.forEach(e=>n.add(e))}}else n.add(T),p.forEach(e=>n.add(e))}for([e,u]of c.entries()){var{primaryKey:w,type:x,options:I}=u;if("radio"===x){var N=I.find(e=>e.isChecked);N&&(_={value:N.valueAttr},Object.assign(_,N.suffixes),w)&&(t.hasOwnProperty(w)?(Array.isArray(t[w])||(t[w]=[t[w]]),t[w].push(_)):t[w]=_)}else if("checkbox"===x){N=I.filter(e=>e.isChecked);if(0<N.length){var _=N.map(e=>e.valueAttr);const P={};N.forEach(e=>{Object.entries(e.suffixes).forEach(([e,t])=>{P[e]||(P[e]=[]),P[e].push(t)})});x={value:_};Object.assign(x,P),w&&(t.hasOwnProperty(w)?(Array.isArray(t[w])||(t[w]=[t[w]]),t[w].push(x)):t[w]=x)}else w&&(t[w]={value:[]})}}return t},observeDataElement(a,e,n){var t=new MutationObserver(e=>{var t,r=F._getRawAttribute(a,"data");r&&(t=R(a))&&n.updateData(r,t.primaryValue)});t.observe(a,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),n._observers||(n._observers=new Set),n._observers.add(t)}};return{config:r,state:e,globalMethods:l,instanceMethods:n,hooks:{initComplete:function(e,t){return r.enabled&&r.settings.debug&&FlowPlater.log(FlowPlater.logLevels.INFO,r.name+" plugin initialized"),e}},transformers:{transformResponse:function(e,t,r){if(FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] transformResponse called with:",{instance:e,response:t,dataType:r}),t&&"html"===r)if(e&&FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] Instance details:",{instanceName:e.instanceName,hasElements:!!e.elements,elements:e.elements,hasExtractData:!!e.elements&&Array.from(e.elements).some(e=>F._hasAttribute(e,"extract-data"))}),e.elements&&Array.from(e.elements).some(e=>F._hasAttribute(e,"extract-data"))){var a=Array.from(e.elements).find(e=>F._hasAttribute(e,"extract-data"));FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] Found extract-data attribute on instance element:",a),FlowPlater.trigger("dataExtractor:beforeTransform",a,{response:t,dataType:r});try{FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] Processing HTML response:",t);var n=l.processHtml(t);return FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] Extracted data result:",n),FlowPlater.trigger("dataExtractor:transformed",a,{response:t,result:n}),JSON.stringify(n)}catch(e){throw FlowPlater.log(FlowPlater.logLevels.ERROR,"[DataExtractor] Error during transformation:",e),FlowPlater.trigger("dataExtractor:transformError",a,{response:t,error:e}),e}}else FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] Skipping data extraction:",e?e.elements?"No extract-data attribute found":"No instance elements":"No instance object");else FlowPlater.log(FlowPlater.logLevels.DEBUG,"[DataExtractor] Skipping data extraction:",t?"Invalid data type: "+r:"No response");return t}}}}}();