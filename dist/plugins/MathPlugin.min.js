var MathPlugin=function(){"use strict";const r={level:1,levels:{ERROR:0,WARN:1,INFO:2,DEBUG:3},log:function(t){this.level},error:function(...t){this.log(this.levels.ERROR,...t)},warn:function(...t){this.log(this.levels.WARN,...t)},info:function(...t){this.log(this.levels.INFO,...t)},debug:function(...t){this.log(this.levels.DEBUG,...t)}};class t extends Error{constructor(t,e){super(t),this.name="FlowPlaterError",void 0!==e&&(this.stack=e)}}class e extends t{constructor(t,e){super(`Template Error${void 0!==e?" in "+e:""}: `+t),this.name="TemplateError"}}function*n(t){for(var e,s=new RegExp(n.lang,"g");null!==(e=s.exec(t));){var i,[r]=e;for(i in n.categories)if(new RegExp(n.categories[i]).test(r)){yield{token:r,category:i};break}}}n.lang=[(n.categories={op:"[+*/^]|-(?!\\d)",num:"-?\\d+(?:\\.\\d+)?%?",group:"[\\[()\\]]",sep:",",ident:"\\b(ans|pi|e)\\b",func:"\\b(sqrt|abs|log|ln|sin|cos|tan|min|max)\\b"}).op,n.categories.num,n.categories.group,n.categories.sep,n.categories.ident,n.categories.func].join("|"),n.cat={INT:"num",IDENT:"ident",PCNT:"num",FUNC:"func",SEP:"sep"};class a{constructor(){Object.defineProperty(this,"stack",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"w",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"l",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.stack=[],this.w=null,this.l=null}_next(){var t=this.l.next();return t.done?null:t.value}exec(t){try{if(this.l=n(t),this.w=this._next(),!this.e())throw new SyntaxError(this.w?this.w.token:"Unexpected end of expression");if(null!==this.w)throw new SyntaxError("Unexpected token: "+this.w.token);return a.ans=this.stack.pop()}catch(t){throw r.error("Error in expression evaluation:",t),t}}_istok(t){return this.w&&t===this.w.token}z(){var t;return!!this._wrapped_expr(this._rep_val,"abs","|","|")||(this.w&&["INT","IDENT","PCNT"].some(t=>n.cat[t]===this.w.category)?(this.stack.push(a._val(this.w)),this.w=this._next(),!0):this.w&&this.w.category===n.cat.FUNC?(t=this.w.token,this.w=this._next(),"min"===t||"max"===t?this._wrapped_expr_min_max(this._rep_val,t):this._wrapped_expr(this._rep_val,t)):!!this._wrapped_expr(this._rep_val,"abs","|","|"))}_wrapped_expr_min_max(t,e,s="(",i=")"){if(this.w&&this.w.token===s){this.w=this._next();for(var r=[];null!==this.w&&this.e()&&(r.push(this.stack.pop()),this.w)&&"sep"===this.w.category;)this.w=this._next();if(this.w&&this.w.token===i)return this.w=this._next(),t instanceof Function&&t.call(this,e,r),!0}return!1}_lrecmut(t,e){return t.call(this)&&e.call(this)}_ophit(t,e,s,i){if(this.w&&t.some(t=>t===this.w.token)){var t=this.w.token,r=this.stack.pop();if(this.w=this._next(),e.call(this))return e=this.stack.pop(),this.stack.push(a._chooseOp(t)(r,e)),s.call(this)}else if(!this.w||i.some(t=>t===this.w.token))return!0;return!1}e(){if(!this.t())return!1;for(;this.w&&("+"===this.w.token||"-"===this.w.token);){var t=this.w.token;if(this.w=this._next(),!this.t())return!1;var e=this.stack.pop(),s=this.stack.pop();this.stack.push(a._chooseOp(t)(s,e))}return!0}t(){for(var t=this.f();this.w&&("*"===this.w.token||"/"===this.w.token);){var e=this.w.token;if(this.w=this._next(),!this.f())return!1;var s=this.stack.pop(),i=this.stack.pop();this.stack.push(a._chooseOp(e)(i,s))}return t}f(){var t;return this.w&&"-"===this.w.token?(this.w=this._next(),!!this.z()&&(t=this.stack.pop(),this.stack.push(-t),!0)):this.z()}ep(){return this._ophit(["+","-"],this.p,this.ep,[")","|",","])}p(){return this._lrecmut(this.x,this.pp)}pp(){return this._ophit(["*","/"],this.x,this.pp,["+","-",")","|",","])}x(){return this._lrecmut(this.z,this.xp)}xp(){return this._ophit(["^"],this.z,this.xp,["*","/","+","-",")","|",","])}_wrapped_expr(t,e,s="(",i=")"){return!!this.w&&!(this.w.token!==s||(this.w=this._next(),!this.e())||!this.w||this.w.token!==i||(this.w=this._next(),t instanceof Function&&t.call(this,e),0))}_rep_val(t,e){if(e)this.stack.push(a._chooseFn(t).apply(null,e));else{e=this.stack.pop();if(void 0===e)throw new Error(`Function ${t} requires an argument`);this.stack.push(a._chooseFn(t)(e))}}static _chooseFn(t){switch(t){case"sqrt":return Math.sqrt;case"log":return Math.log10;case"ln":return Math.log;case"abs":return Math.abs;case"min":return Math.min;case"max":return Math.max;case"sin":return Math.sin;case"cos":return Math.cos;case"tan":return Math.tan;default:throw new Error("Unknown function: "+t)}}static _val(t){var e;return t.category===n.cat.INT||t.category===n.cat.PCNT?(e=parseFloat(t.token),t.token.endsWith("%")&&(e/=100)):t.category===n.cat.IDENT&&("pi"===t.token?e=Math.PI:"e"===t.token?e=Math.E:"ans"===t.token&&(e=this.ans)),e}static _chooseOp(t){switch(t){case"+":return(t,e)=>t+e;case"-":return(t,e)=>t-e;case"*":return(t,e)=>t*e;case"/":return(t,e)=>t/e;case"^":return(t,e)=>Math.pow(t,e);default:throw new Error("Unknown operator: "+t)}}}a.ans=0;return(t={})=>{const s={name:"math",enabled:!0,priority:100,version:"1.0.0",dependencies:[],optionalDependencies:[],settings:{debug:!1},description:"Provides mathematical expression evaluation capabilities through the math helper",author:"FlowPlater Team"};Object.assign(s,t);return{config:s,state:{initialized:!1,data:{}},globalMethods:{evaluateExpression(t,e){try{return(new a).exec(e)}catch(t){throw r.error("Error evaluating math expression:",t),t}}},instanceMethods:{},hooks:{initComplete:function(t,e){return s.enabled&&r.debug(s.name+" plugin initialized successfully"),t}},transformers:{},helpers:{math:function(t,s){const i=["min","max","sqrt","abs","log","ln","sin","cos","tan"];t=t.replace(/@{([^}]+)}/g,(t,e)=>{try{let t;return t=e.includes(".")?e.split(".").reduce((t,e)=>t[e],s.data.root):s.data.root[e]||s.hash[e]}catch(t){return NaN}}).replace(/[a-zA-Z_][a-zA-Z0-9_]*(\.[a-zA-Z0-9_]+)*/g,e=>{if(i.includes(e)&&!e.includes("."))return e;try{let t;return t=e.includes(".")?e.split(".").reduce((t,e)=>t[e],s.data.root):s.data.root[e]||s.hash[e]}catch(t){return NaN}});r.debug("Evaluating expression:",t);try{return(new a).exec(t)}catch(t){if(t instanceof e)throw t;throw new e("Error evaluating expression: "+t.message,t.stack)}}}}}}();