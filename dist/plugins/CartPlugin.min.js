var CartPlugin=function(){"use strict";const o={level:1,levels:{ERROR:0,WARN:1,INFO:2,DEBUG:3},log:function(t){this.level},error:function(...t){this.log(this.levels.ERROR,...t)},warn:function(...t){this.log(this.levels.WARN,...t)},info:function(...t){this.log(this.levels.INFO,...t)},debug:function(...t){this.log(this.levels.DEBUG,...t)}},P={INHERITABLE_ATTRIBUTES:{"hx-":["boost","push-url","select","select-oob","swap","target","vals","confirm","disable","disabled-elt","encoding","ext","headers","include","indicator","params","prompt","replace-url","request","sync","vars"],"fp-":["prepend","append","persist","target"]},_prefixes(){return Object.keys(this.INHERITABLE_ATTRIBUTES)},_normalizeAttributeName(t){return t.replace(/^(hx-|fp-)/,"").replace(/^data-/,"")},_getAllAttributeNames(t){var e=this._normalizeAttributeName(t),r=[];for(const a of this._prefixes())r.push(""+a+e),r.push("data-"+a+e);return r},_getRawAttribute(t,e,r=null){for(const i of this._getAllAttributeNames(e)){var a=t.getAttribute(i);if(null!==a)return a}return r},_hasAttribute(e,t){return this._getAllAttributeNames(t).some(t=>e.hasAttribute(t))},findMatchingElements(t,e=null,r=!0,a=document,i=!0,n=!1){var l=this._getAllAttributeNames(t);let o=l.map(t=>`[${t}]`).join(",");if(null!=e){const s=r?`="${e}"`:`*="${e}"`;o=l.map(t=>`[${t}${s}]`).join(",")}l=Array.from(a.querySelectorAll(o));return i&&a instanceof Element&&(null===(i=this._getRawAttribute(a,t))||null!=e&&(r?i!==e:!i.includes(e))||l.unshift(a)),null!=e&&n?l[0]:l},findClosestParent(t,e,r=null,a=!0){if(!t)return o.error("Attribute name is required"),null;if(!e)return o.error("Element is required to find closest parent ("+t+")"),null;var t=this._normalizeAttributeName(t),i=this._getAllAttributeNames(t);let n=i.map(t=>`[${t}]`).join(",");if(null!=r){const l=a?`="${r}"`:`*="${r}"`;n=i.map(t=>`[${t}${l}]`).join(",")}a=e.closest(n);if(a&&this.isInheritable(t)){r=this._getRawAttribute(a,"disinherit");if(r&&("*"===r||r.split(" ").includes(t)))return null}return a},getElementWithAttribute(t,e=document,r=!0){return r&&e instanceof Element&&this._hasAttribute(e,t)?e:(r=this._getAllAttributeNames(t).map(t=>`[${t}]`).join(","),e.querySelector(r))},_parentElement(t){var e=t.parentElement;return!e&&t.parentNode instanceof ShadowRoot?t.parentNode:e},_getRootNode(t,e=!1){return t.getRootNode?t.getRootNode({composed:e}):document},_getClosestMatch(t,e){for(;t&&!e(t);)t=this._parentElement(t);return t||null},_attributeMatchesNormalizedName(t,e){return t.replace(/^data-/,"").replace(/^hx-/,"").replace(/^fp-/,"")===e},_getAttributeValueWithInheritance(t,e,r){var a=this._getRawAttribute(e,r),i=this._getRawAttribute(e,"disinherit"),n=this._getRawAttribute(e,"inherit");if(t!==e){if(htmx.config.disableInheritance)return n&&("*"===n||n.split(" ").includes(r))?a:null;if(i&&("*"===i||i.split(" ").includes(r)))return"unset"}return a},findInheritedAttribute(e,t){const r=this._normalizeAttributeName(t);let a=null;return this._getClosestMatch(e,t=>{t=this._getAttributeValueWithInheritance(e,t,r);return!!t&&(a=t,!0)}),"unset"===a?null:a},findAttribute(t,e){var r=this._normalizeAttributeName(e);for(const i of this._prefixes()){var a=this._getRawAttribute(t,""+i+r);if(a)return a}return this.findInheritedAttribute(t,r)||null},_validateAttributeName(t){return t?!!this.isInheritable(t)||(o.info(`Attribute ${t} is not inheritable`),!1):(o.error("Attribute name is required"),!1)},addInheritableAttribute(t,e){this.INHERITABLE_ATTRIBUTES[t]||(this.INHERITABLE_ATTRIBUTES[t]=[]),this.INHERITABLE_ATTRIBUTES[t].push(e)},removeInheritableAttribute(t,e){return!!this.INHERITABLE_ATTRIBUTES[t]&&-1!==(e=this.INHERITABLE_ATTRIBUTES[t].indexOf(e))&&(this.INHERITABLE_ATTRIBUTES[t].splice(e,1),!0)},isInheritable(t){t=this._normalizeAttributeName(t);return Object.values(this.INHERITABLE_ATTRIBUTES).flat().includes(t)},findTemplateElementByInstanceName(e){var t;return e.startsWith("#")?(t=e.slice(1),(t=document.getElementById(t))&&this._hasAttribute(t,"template")?t:null):(t=this.findMatchingElements("template"),Array.isArray(t)&&t.find(t=>{return this._getRawAttribute(t,"instance")===e})||null)},findElementByInstanceName(t){if(t.startsWith("#")){var e=t.slice(1);const r=document.getElementById(e);return r}const r=this.findMatchingElements("instance",t,!1,document,!1,!0);return r}},n={TEMPLATE:{CACHE_SIZE:100,PRECOMPILE:!0,ANONYMOUS_INSTANCE_NAME:"anonymous",SELF_TEMPLATE_ID:"self"},ANIMATION:{ENABLED:!0,DURATION:300},DEBUG:{LEVEL:1,DEVELOPMENT_LEVEL:3},HTMX:{TIMEOUT:1e4,SWAP_STYLE:"innerHTML",SELF_REQUESTS_ONLY:!1,IGNORE_TITLE:!0,DEFAULT_TRIGGER:"mouseover",SWAP_DELAY:0,SETTLE_DELAY:0,TRANSITION:!1},STORAGE:{ENABLED:!1,TTL:2592e3,INFINITE_TTL:-1},PERFORMANCE:{BATCH_DOM_UPDATES:!0,BATCHING_DELAY:0,DEBOUNCE_DELAY:0},FORMS:{PERSIST_FORMS:!0,DEFAULT_SOURCE:"unknown",TRIGGER_EVENTS:"change",EXCLUDED_INPUT_TYPES:["file"],CHECKBOX_RADIO_TYPES:["checkbox","radio"],TEXT_INPUT_TYPES:["text"],FORM_INPUT_TYPES:["INPUT","SELECT","TEXTAREA"]},PLUGINS:{DEFAULT_PRIORITY:0,DEFAULT_VERSION:"1.0.0",DEBUG:!1},CART:{ENABLED:!0,PRIORITY:50,DATA_ATTRIBUTE:"product",GROUP_NAME:"cart",REQUIRED_KEYS:["id","name"],CURRENCY:{NAME:"USD",SYMBOL:"$",PRECISION:2,SEPARATOR:",",DECIMAL:"."},TAX_RATES:[{name:"VAT",value:1.21}],LOCALE:"en-US",STOCK:{INFINITE:1/0,MIN_AMOUNT:0}},FILTER:{ENABLED:!0,PRIORITY:0,DEFAULT_SELECT_OPTION:"Select tags...",PRESERVE_DEFAULT:!1},DATA_EXTRACTOR:{VALUE_SOURCES:{ATTRIBUTE:"attribute",TEXT:"text"}},PROXY:{DEFAULT_URL:""},MATH:{OPERATORS:{ADD:"+",SUBTRACT:"-",MULTIPLY:"*",DIVIDE:"/"}},DOM:{UPDATE_COUNTER_INITIAL:0,UNKNOWN_ELEMENT_ID:"unknown",INTEGRITY_CHECK_ENABLED:!0,VOID_ELEMENTS:["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],SVG_NAMESPACE:"http://www.w3.org/2000/svg",SVG_ELEMENTS:["svg","circle","ellipse","line","polygon","polyline","rect","path","g","text","tspan","defs","use","symbol","marker","clipPath","mask","pattern","image","foreignObject"],WEBFLOW_CLASSES:["w-checkbox","w-radio","w-checkbox-input","w-radio-input","w-form","w-input","w-select","w-textarea"],SIMILARITY_THRESHOLD:.5,LENGTH_RATIO_THRESHOLD:.5},INSTANCES:{DUPLICATE_INIT_WINDOW:100},EVENTS:{HTTP_METHODS:["get","post","put","patch","delete"],HTTP_TRIGGER_ATTRIBUTES:["trigger","boost","ws","sse"]},HELPERS:{EACH:{START_AT:0,SORT_KEY:"",DESCENDING:!1,SORT_BEFORE_LIMIT:!0},COMPARISON:{DEFAULT_OPERATOR:"=="}},CONTENT_TYPES:{UNKNOWN:"unknown",JSON:"json",HTML:"html",XML:"xml"},ERRORS:{XML_PARSER_ERROR:"Unknown parser error"},URL:{WEBFLOW_DOMAINS:[".webflow.io",".canvas.webflow.com"],LOCALHOST:"localhost"},SELECTORS:{FP_ATTRIBUTES:["template","get","post","put","delete","patch","persist","instance","data","local","group","target","swap","trigger","dynamic"],TEMPLATE_ELEMENTS:["template","fptemplate"],EXTENSION_ATTRIBUTE:"hx-ext"},SECURITY:{ALLOW_EXECUTE:!0,FORBIDDEN_REGISTRATIONS:new Set(["if","unless","each","with","lookup","log","blockHelperMissing","helperMissing"])}};var a={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:function(t,e){var r=e.pattern,a=e.negativePattern,i=e.symbol,n=e.separator,l=e.decimal,e=e.groups,o=(""+t).replace(/^-/,"").split("."),s=o[0],o=o[1];return(0<=t.value?r:a).replace("!",i).replace("#",s.replace(e,"$1"+n)+(o?l+o:""))},fromCents:!1},s=function(t){return Math.round(t)},c=function(t){return Math.pow(10,t)},i=/(\d)(?=(\d{3})+\b)/g,l=/(\d)(?=(\d\d)+\d\b)/g;function F(t,e){if(!(this instanceof F))return new F(t,e);var e=Object.assign({},a,e),r=c(e.precision),t=u(t,e);this.intValue=t,this.value=t/r,e.increment=e.increment||1/r,e.useVedic?e.groups=l:e.groups=i,this.s=e,this.p=r}function u(t,e,r){var r=!(2<arguments.length&&void 0!==r)||r,a=0,i=e.decimal,n=e.errorOnInvalid,l=e.precision,e=e.fromCents,l=c(l),o=t instanceof F;if(o&&e)return t.intValue;if("number"==typeof t||o)a=o?t.value:t;else if("string"==typeof t){o=new RegExp("[^-\\d"+i+"]","g"),i=new RegExp("\\"+i,"g");a=(a=t.replace(/\((.*)\)/,"-$1").replace(o,"").replace(i,"."))||0}else{if(n)throw Error("Invalid Input");a=0}return e||(a=(a*=l).toFixed(4)),r?s(a):a}F.prototype={add:function(t){var e=this.intValue,r=this.s,a=this.p;return F((e+=u(t,r))/(r.fromCents?1:a),r)},subtract:function(t){var e=this.intValue,r=this.s,a=this.p;return F((e-=u(t,r))/(r.fromCents?1:a),r)},multiply:function(t){var e=this.intValue,r=this.s;return F((e*=t)/(r.fromCents?1:c(r.precision)),r)},divide:function(t){var e=this.intValue,r=this.s;return F(e/=u(t,r,!1),r)},distribute:function(t){for(var e=this.intValue,r=this.p,a=this.s,i=[],n=Math[0<=e?"floor":"ceil"](e/t),l=Math.abs(e-n*t),o=a.fromCents?1:r;0!==t;t--){var s=F(n/o,a);0<l--&&(s=s[0<=e?"add":"subtract"](1/o)),i.push(s)}return i},dollars:function(){return~~this.value},cents:function(){return~~(this.intValue%this.p)},format:function(t){var e=this.s;return"function"==typeof t?t(this,e):e.format(this,Object.assign({},e,t))},toString:function(){var t=this.intValue,e=this.p,r=this.s;return t=t/e,e=r.increment,(s(t/e)*e).toFixed(r.precision)},toJSON:function(){return this.value}};return(t={})=>{FlowPlater.config({storage:{enabled:!0}}),FlowPlater.log(FlowPlater.logLevels.INFO,"[CartPlugin] Early config executed: Storage enabled.");const d={name:"cart",enabled:n.CART.ENABLED,priority:n.CART.PRIORITY,version:n.PLUGINS.DEFAULT_VERSION,dependencies:["data-extractor"],optionalDependencies:[],settings:{debug:n.PLUGINS.DEBUG,dataAttribute:n.CART.DATA_ATTRIBUTE,group:n.CART.GROUP_NAME,requiredKeys:n.CART.REQUIRED_KEYS},description:"Shopping cart functionality for FlowPlater",author:"FlowPlater Team",currency:{name:n.CART.CURRENCY.NAME,symbol:n.CART.CURRENCY.SYMBOL,precision:n.CART.CURRENCY.PRECISION,separator:n.CART.CURRENCY.SEPARATOR,decimal:n.CART.CURRENCY.DECIMAL,...t.currency},taxRates:n.CART.TAX_RATES,locale:(e=t.locale,r=n.CART.LOCALE,e??r)};Object.assign(d,t);const g=(t,e)=>{var r=t?.id;if(null==r)return FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Cannot generate cart item ID: Base product ID is missing.",t),null;e=e?P._getRawAttribute(e,"cart-variant-key",null):null;if(!e)return r.toString();e=e.split(",").map(t=>t.trim()).sort();if(0===e.length)return r.toString();var a,i=[];let n=!1;for(const l of e)t.hasOwnProperty(l)&&null!=(a=t[l])&&""!==a&&(n=!0,"string"==typeof a||"number"==typeof a?i.push(encodeURIComponent(l)+"="+encodeURIComponent(a)):FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] Variant key '${l}' has non-primitive value, skipping for ID generation:`,a));return n?r+"::"+i.join(";"):r.toString()},E={cart:{items:new Map,totalItems:0,totalPrice:0,totalDiscount:0,totalTax:0,totalAmount:0,totalItemsFmt:"",totalPriceFmt:"",totalDiscountFmt:"",totalTaxFmt:"",totalAmountFmt:""},observers:new Map},c=()=>{var t=P.findMatchingElements("data",d.settings.dataAttribute);(Array.isArray(t)?t:t?[t]:[]).forEach(e=>{if(!e.closest(`[fp-group="${d.settings.group}"]`)){var r=I(e);if(r){var a=e.querySelector("[fp-cart-add]");const u=g(r,a);var i=E.cart.items.get(u),n=e.querySelector("[fp-cart-item-amount]"),e=e.querySelector("[fp-cart-remove]"),i=i?.amount||0,l=void 0===r.stock||null===r.stock?1/0:r.stock,o=f(r.id),s=l<=o,c=i<=0;if(n&&(n.value=i,n.min="0",i=Math.max(0,l-(o-i)),n.max=i),a){let t=s;if(1===l&&1===o){const m=r.id?.toString();Array.from(E.cart.items.keys()).some(t=>t.split("::")[0]===m&&t!==u)&&(t=!1)}a.disabled=t,a.disabled?a.classList.add("fp-disabled"):a.classList.remove("fp-disabled")}if(e){let t=!c;n=E.cart.items.has(r.id?.toString()),i=u===r.id?.toString();n&&i&&(t=!0),e.disabled=!t,t?e.classList.remove("fp-disabled"):e.classList.add("fp-disabled")}}}}),FlowPlater.trigger("cart:productStatesUpdated",null,{})},a=()=>{return{items:Array.from(E.cart.items.values()).map(t=>({...t,amountFmt:t.amountFmt,unitPriceFmt:t.unitPriceFmt,totalPriceFmt:t.totalPriceFmt,discountFmt:t.discountFmt,totalDiscountFmt:t.totalDiscountFmt,taxFmt:t.taxFmt})),totalItems:E.cart.totalItems,totalItemsFmt:E.cart.totalItemsFmt,totalPrice:E.cart.totalPrice,totalPriceFmt:E.cart.totalPriceFmt,totalDiscount:E.cart.totalDiscount,totalDiscountFmt:E.cart.totalDiscountFmt,totalTax:E.cart.totalTax,totalTaxFmt:E.cart.totalTaxFmt,totalAmount:E.cart.totalAmount,totalAmountFmt:E.cart.totalAmountFmt}},s=t=>{if(t){const e=new Map;Array.isArray(t.items)&&t.items.forEach(t=>{t&&void 0!==t.cartItemId?e.set(t.cartItemId,t):t&&void 0!==t.id&&(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Cart item missing cartItemId during deserialization. Using base id as fallback key.",t),e.set(t.id,t))}),E.cart.items=e,E.cart.totalItems=t.totalItems||0,E.cart.totalPrice=t.totalPrice||0,E.cart.totalDiscount=t.totalDiscount||0,E.cart.totalTax=t.totalTax||0,E.cart.totalAmount=t.totalAmount||0,FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] State after deserializeCart:",E.cart)}else E.cart.items=new Map,E.cart.totalItems=0,E.cart.totalPrice=0,E.cart.totalDiscount=0,E.cart.totalTax=0,E.cart.totalAmount=0,FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] State reset in deserializeCart (no data).")},m=t=>{return P.findClosestParent("data",t,d.settings.dataAttribute,!0)};function p(t){if("number"==typeof t)return t;if(!t)return 0;let e=t.toString().trim();e=e.replace(/[^\d.,\- ]/g,"");try{return F(e,{separator:d.currency.separator,decimal:d.currency.decimal}).value}catch(t){return 0}}const u=(t,e)=>{t=p(t);return e?"string"==typeof e&&e.endsWith("%")?t*(1-parseFloat(e)/100):Math.max(0,t-p(e)):t},A=t=>{t=E.cart.items.get(t);return t?t.amount:0},f=e=>{let r=0;return E.cart.items.forEach(t=>{t.cartItemId.split("::")[0]===e.toString()&&(r+=t.amount)}),r},h=()=>{let n=0,l=0,o=0,s=0,e=0;var t=E.cart.totalItems,r=(E.cart.items.forEach(e=>{n+=e.amount;var t=p(e.price)||0,r=e.discount||"0",r=u(t,r),a=r*e.amount,i=a*(d.taxRates.find(t=>t.name.toLowerCase()===e.taxRate?.toLowerCase())?.value||d.taxRates[0].value);l+=t*e.amount,o+=(t-r)*e.amount,s+=i-a}),e=l-o+s,E.cart.totalItems=n,E.cart.totalPrice=l,E.cart.totalDiscount=o,E.cart.totalTax=s,E.cart.totalAmount=e,E.cart.totalItemsFmt=E.cart.totalItems.toString(),E.cart.totalPriceFmt=T(E.cart.totalPrice,{currencySymbol:d.currency.symbol}),E.cart.totalDiscountFmt=T(E.cart.totalDiscount,{currencySymbol:d.currency.symbol}),E.cart.totalTaxFmt=T(E.cart.totalTax,{currencySymbol:d.currency.symbol}),E.cart.totalAmountFmt=T(E.cart.totalAmount,{currencySymbol:d.currency.symbol}),P.findMatchingElements("data",d.settings.dataAttribute)),r=((Array.isArray(r)?r:r?[r]:[]).forEach(e=>{if(e.closest(`[fp-group="${d.settings.group}"]`)){const o=I(e);void(o&&(t=Array.from(E.cart.items.values()).find(t=>t.id===o.id&&(!t.cartItemId||t.cartItemId===e.getAttribute("fp-cart-item-id"))))&&t.cartItemId&&e.setAttribute("fp-cart-item-id",t.cartItemId))}else{const o=I(e);var t,r,a,i,n,l;o&&(t=e.querySelector("[fp-cart-add]"),r=e.querySelector("[fp-cart-remove]"),a=e.querySelector("[fp-cart-item-amount]"),i=g(o,t),i=A(i),n=void 0===o.stock||null===o.stock?1/0:o.stock,l=i<=0,t&&(t.disabled=n<=i),r&&(r.disabled=l),a)&&(a.value=i,a.min="0",a.max=n)}}),P.findMatchingElements("cart-total-count")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=n.toString()}),P.findMatchingElements("cart-total-price")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=l.toFixed(2)}),P.findMatchingElements("cart-total-discount")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=o.toFixed(2)}),P.findMatchingElements("cart-total-tax")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=s.toFixed(2)}),P.findMatchingElements("cart-total-amount")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=e.toFixed(2)}),a());FlowPlater.updateGroup(d.settings.group,r),FlowPlater.trigger("cart:updated",null,{cart:E.cart}),document.querySelectorAll(`[fp-group="${d.settings.group}"] [fp-cart-remove]`).forEach(t=>{t.disabled=!1}),c(),t!==n&&FlowPlater.trigger("cart:amountUpdated",null,{oldCount:t,newCount:n})};function T(t,e={}){return"number"!=typeof t||isNaN(t)?"":F(t,{symbol:void 0!==e.currencySymbol?e.currencySymbol:d.currency.symbol||"",separator:d.currency.separator,decimal:d.currency.decimal,precision:void 0!==e.mantissa?e.mantissa:d.currency.precision}).format()}const R=(t,e=null)=>{e=g(t,e);e&&(E.cart.items.delete(e),FlowPlater.trigger("cart:productRemoved",null,{productData:t,cartItemId:e}),h())},i=t=>{var e=d.settings,r=e.variantKey||"variant";const a=e.variantIdKey||"id";var i,e=e.variantSelectorKey||"selected-variant",n=t[r];const l=t[e];return Array.isArray(n)&&0!==n.length?"string"!=typeof l&&"number"!=typeof l?(FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] Invalid or missing value for selector key '${e}'. Expected string or number, got:`,l),delete t[r],t.hasOwnProperty(e)&&delete t[e],t):(n=n.find(t=>t&&t[a]?.toString()===l.toString()))?(delete(i={...t})[r],delete i[e],Object.assign(i,n),FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Variant merged",{baseData:t,selectedVariant:n,mergedData:i}),i):(FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] No variant found with ${a} matching selector value:`,l),delete t[r],t.hasOwnProperty(e)&&delete t[e],t):(t.hasOwnProperty(e)&&delete t[e],t)},I=t=>{FlowPlater.log(FlowPlater.logLevels.INFO,"Processing HTML",t);let e=null;try{e=FlowPlater.getPlugin("data-extractor").instanceMethods.extractData(t)}catch(t){return FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Failed to extract data using DataExtractorPlugin.",t),null}var r;return e&&0!==Object.keys(e).length?(r=e[d.settings.dataAttribute]||e,i(r)):(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Data extraction yielded no data.",t),null)},v=(t,e,r=null)=>{var a,i,n=g(t,r);n&&((a=E.cart.items.get(n))?(i=void 0===a.stock||null===a.stock?1/0:a.stock,0===(e=Math.min(Math.max(0,e),i))?(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Removing item ${n} (newAmount is 0).`),R(t,r)):e!==a.amount?(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Updating item ${n} from ${a.amount} to ${e}.`),a.amount=e,h()):FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Item ${n} amount (${a.amount}) unchanged.`)):FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount called for non-existent item: ${n}. No action taken.`))};var e={initComplete:function(t){var e=FlowPlater.getOrCreateGroup(d.settings.group,{}),e=(e&&e.data?(FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Calling deserializeCart with group data:",e.data),s(e.data)):(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] No group or group data found in initComplete."),s(null)),P.findMatchingElements("data",d.settings.dataAttribute)),e=((Array.isArray(e)?e:e?[e]:[]).forEach(t=>{t=Array.from(t.querySelectorAll('input[type="radio"]'));const e={};t.forEach(t=>{t.name&&(e[t.name]||(e[t.name]=[]),e[t.name].push(t))}),Object.values(e).forEach(t=>{t.some(t=>t.checked)||(t[0].checked=!0)})}),()=>{document.querySelectorAll("[fp-cart-add], [fp-cart-remove], [fp-cart-item-amount]").forEach(t=>{t.removeEventListener("click",n),t.removeEventListener("change",l),t.removeEventListener("input",o)}),document.removeEventListener("click",r),document.removeEventListener("change",a),document.removeEventListener("input",i),document.addEventListener("click",r),document.addEventListener("change",a),document.addEventListener("input",i),c()});const r=e=>{var r=e.target.closest("[fp-cart-add], [fp-cart-remove]");if(r){e.preventDefault(),e.stopPropagation();var e=r.hasAttribute("fp-cart-add"),t=r.hasAttribute("fp-cart-remove");if(e||t){r=m(r);if(r){var a=r.closest(`[fp-group="${d.settings.group}"]`);if(t&&a){let t=r.getAttribute("fp-data-cart-item-id");if(t||(a=I(r))&&(i=Object.keys(a).filter(t=>"id"!==t&&"amount"!==t&&"price"!==t&&"stock"!==t&&"cartItemId"!==t&&!d.settings.requiredKeys.includes(t)),(n=document.createElement("button")).setAttribute("fp-cart-variant-key",i.join(",")),t=g(a,n)),t)return FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Remove button clicked for cart item: "+t),E.cart.items.delete(t),void h()}const c=I(r);if(c){const u=r.querySelector("[fp-cart-add]");var i=u?P._getRawAttribute(u,"cart-variant-key",null):null;if(i){a=i.split(",").map(t=>t.trim()).filter(Boolean);if(a.some(t=>!c[t]))return FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Cannot add to cart: Not all variant options are selected.",{variantKeys:a,productData:c}),u.classList.add("fp-variant-missing"),void setTimeout(()=>u.classList.remove("fp-variant-missing"),1e3)}if(e){var n=r.querySelector("[fp-cart-item-amount]");let t=1;n&&(i=parseInt(n.value),!isNaN(i))&&0<i&&(t=i);var a=g(c,u),[l,e=1,n=null]=(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Add button clicked for ${a}, amount from input: `+t),[c,t,u]),i=d.settings.requiredKeys.filter(t=>!(t in l)).join(", ");if(i)FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Product missing required fields: "+i);else{i=g(l,n);if(i){var n=E.cart.items.get(i),a=void 0===l.stock||null===l.stock?1/0:l.stock,o=f(l.id);if(1===a&&1===o&&!n){let r=null;if(E.cart.items.forEach((t,e)=>{e.split("::")[0]===l.id.toString()&&(r=e)}),r)return void(s=E.cart.items.get(r),E.cart.items.delete(r),E.cart.items.set(i,{...l,cartItemId:i,amount:1,amountFmt:F(1).format(),unitPrice:s.price,unitPriceFmt:T(s.price),totalPrice:s.price,totalPriceFmt:T(s.price),discount:s.discount,discountFmt:T(s.discount),totalDiscount:+s.discount,totalDiscountFmt:T(+s.discount),tax:s.tax,taxFmt:T(s.tax),taxRate:s.taxRate||d.taxRates[0].name}),FlowPlater.log(FlowPlater.logLevels.INFO,`[CartPlugin] Replaced variant ${r} with ${i} (stock: 1)`),FlowPlater.trigger("cart:variantReplaced",null,{oldVariantId:r,newVariantId:i,product:l}),h())}var s=Math.max(0,a-o);if(n){a=n.amount,o=Math.min(a+e,a+s);if(o===a)return;n.amount=o}else{a=Math.min(e,s);if(a<=0)return;n=p(l.price)||0,o=p(l.discount)||0,e=d.taxRates.find(t=>t.name.toLowerCase()===l.taxRate?.toLowerCase())?.value||d.taxRates[0].value;E.cart.items.set(i,{...l,cartItemId:i,amount:a,amountFmt:a.toString(),unitPrice:n,unitPriceFmt:T(n),totalPrice:n*a,totalPriceFmt:T(n*a),discount:o,discountFmt:T(o),totalDiscount:o*a,totalDiscountFmt:T(o*a),tax:(n*a-o*a)*(e-1),taxFmt:T((n*a-o*a)*(e-1)),taxRate:l.taxRate||d.taxRates[0].name}),FlowPlater.trigger("cart:productAdded",null,{product:l,cartItemId:i})}h()}}}else t&&(s=g(c,u),FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Remove button clicked for product: "+s),R(c,u))}else FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Could not extract product data.",{element:r})}}}},a=t=>{var e=t.target.closest("[fp-cart-item-amount]");if(e){t.preventDefault(),t.stopPropagation();const n=m(e);if(n){var r=I(n);if(!r)return void FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Could not extract product data on change.",{element:n});var a=n.querySelector("[fp-cart-add]"),i=g(r,a);FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Input changed for ${i}, new value: `+e.value),v(r,parseInt(e.value)||0,a)}}else{const n=m(t.target);n&&c()}},i=t=>{var e,r,a,t=t.target.closest("[fp-cart-item-amount]");t&&(r=m(t))&&(e=I(r))&&(r=r.querySelector("[fp-cart-add]"),a=g(e,r),FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Input changed for ${a}, new value: `+t.value),v(e,parseInt(t.value)||0,r))},n=()=>{},l=()=>{},o=()=>{};e(),FlowPlater.on("afterDomUpdate",e);e=P.findMatchingElements("data",d.settings.dataAttribute);return(Array.isArray(e)?e:e?[e]:[]).forEach(t=>{var i;i=t,E.observers.has(i)||((t=new MutationObserver(t=>{for(const a of t){var e,r;("attributes"===a.type&&P._attributeMatchesNormalizedName(a.attributeName,"data")||"characterData"===a.type&&P._hasAttribute(a.target.parentElement,"data"))&&(e=I(i),r=E.cart.items.get(e.id))&&(Object.assign(r,e),h())}})).observe(i,{attributes:!0,attributeFilter:P._getAllAttributeNames("data"),characterData:!0,subtree:!0}),E.observers.set(i,t))}),h(),d.settings.debug&&FlowPlater.log(FlowPlater.logLevels.INFO,"[CartPlugin] Initialized successfully"),t}},r=i=>{return Array.from(E.cart.items.values()).map(e=>{let r;if(Array.isArray(i)&&0<i.length)r=i;else{var a=e.cartItemId||"";let t=[];a.includes("::")&&(a=a.split("::")[1],t=a.split(";").map(t=>decodeURIComponent(t.split("=")[0])).filter(Boolean)),r=[...t,"price"]}let t="";return(t=0<r.length?r.filter(t=>t in e).map(t=>t+": "+e[t]).join(", "):t)?`${e.name} (${t})`:e.name}).join(", ")};return"function"!=typeof FlowPlater.getCartItemsAsString&&(FlowPlater.getCartItemsAsString=r),{config:d,state:E,hooks:e,globalMethods:{getCartItemsAsString:r}}}}();