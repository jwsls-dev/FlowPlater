var CartPlugin=function(){"use strict";const n={level:1,levels:{ERROR:0,WARN:1,INFO:2,DEBUG:3},log:function(t){this.level},error:function(...t){this.log(this.levels.ERROR,...t)},warn:function(...t){this.log(this.levels.WARN,...t)},info:function(...t){this.log(this.levels.INFO,...t)},debug:function(...t){this.log(this.levels.DEBUG,...t)}},E={INHERITABLE_ATTRIBUTES:{"hx-":["boost","push-url","select","select-oob","swap","target","vals","confirm","disable","disabled-elt","encoding","ext","headers","include","indicator","params","prompt","replace-url","request","sync","vars"],"fp-":["prepend","append","persist","target"]},_prefixes(){return Object.keys(this.INHERITABLE_ATTRIBUTES)},_normalizeAttributeName(t){return t.replace(/^(hx-|fp-)/,"").replace(/^data-/,"")},_getAllAttributeNames(t){var e=this._normalizeAttributeName(t),r=[];for(const a of this._prefixes())r.push(""+a+e),r.push("data-"+a+e);return r},_getRawAttribute(t,e,r=null){for(const o of this._getAllAttributeNames(e)){var a=t.getAttribute(o);if(null!==a)return a}return r},_hasAttribute(e,t){return this._getAllAttributeNames(t).some(t=>e.hasAttribute(t))},findMatchingElements(t,e,r=!0,a=document,o=!0,i=!1){var l=this._getAllAttributeNames(t);let n=l.map(t=>`[${t}]`).join(",");if(null!=e){const s=r?`="${e}"`:`*="${e}"`;n=l.map(t=>`[${t}${s}]`).join(",")}l=Array.from(a.querySelectorAll(n));return o&&a instanceof Element&&(null===(o=this._getRawAttribute(a,t))||null!=e&&(r?o!==e:!o.includes(e))||l.unshift(a)),null!=e&&i?l[0]:l},findClosestParent(t,e,r=!0,a){if(!t)return n.error("Attribute name is required"),null;if(!a)return n.error("Element is required to find closest parent ("+t+")"),null;var t=this._normalizeAttributeName(t),o=this._getAllAttributeNames(t);let i=o.map(t=>`[${t}]`).join(",");if(null!=e){const l=r?`="${e}"`:`*="${e}"`;i=o.map(t=>`[${t}${l}]`).join(",")}r=a.closest(i);if(r&&this.isInheritable(t)){e=this._getRawAttribute(r,"disinherit");if(e&&("*"===e||e.split(" ").includes(t)))return null}return r},getElementWithAttribute(t,e=document,r=!0){return r&&e instanceof Element&&this._hasAttribute(e,t)?e:(r=this._getAllAttributeNames(t).map(t=>`[${t}]`).join(","),e.querySelector(r))},_parentElement(t){var e=t.parentElement;return!e&&t.parentNode instanceof ShadowRoot?t.parentNode:e},_getRootNode(t,e=!1){return t.getRootNode?t.getRootNode({composed:e}):document},_getClosestMatch(t,e){for(;t&&!e(t);)t=this._parentElement(t);return t||null},_attributeMatchesNormalizedName(t,e){return t.replace(/^data-/,"").replace(/^hx-/,"").replace(/^fp-/,"")===e},_getAttributeValueWithInheritance(t,e,r){var a=this._getRawAttribute(e,r),o=this._getRawAttribute(e,"disinherit"),i=this._getRawAttribute(e,"inherit");if(t!==e){if(htmx.config.disableInheritance)return i&&("*"===i||i.split(" ").includes(r))?a:null;if(o&&("*"===o||o.split(" ").includes(r)))return"unset"}return a},findInheritedAttribute(e,t){const r=this._normalizeAttributeName(t);let a=null;return this._getClosestMatch(e,t=>{t=this._getAttributeValueWithInheritance(e,t,r);return!!t&&(a=t,!0)}),"unset"===a?null:a},findAttribute(t,e){var r=this._normalizeAttributeName(e);for(const o of this._prefixes()){var a=this._getRawAttribute(t,""+o+r);if(a)return a}return this.findInheritedAttribute(t,r)||null},_validateAttributeName(t){return t?!!this.isInheritable(t)||(n.info(`Attribute ${t} is not inheritable`),!1):(n.error("Attribute name is required"),!1)},addInheritableAttribute(t,e){this.INHERITABLE_ATTRIBUTES[t]||(this.INHERITABLE_ATTRIBUTES[t]=[]),this.INHERITABLE_ATTRIBUTES[t].push(e)},removeInheritableAttribute(t,e){return!!this.INHERITABLE_ATTRIBUTES[t]&&-1!==(e=this.INHERITABLE_ATTRIBUTES[t].indexOf(e))&&(this.INHERITABLE_ATTRIBUTES[t].splice(e,1),!0)},isInheritable(t){t=this._normalizeAttributeName(t);return Object.values(this.INHERITABLE_ATTRIBUTES).flat().includes(t)}};var a={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:function(t,e){var r=e.pattern,a=e.negativePattern,o=e.symbol,i=e.separator,l=e.decimal,e=e.groups,n=(""+t).replace(/^-/,"").split("."),s=n[0],n=n[1];return(0<=t.value?r:a).replace("!",o).replace("#",s.replace(e,"$1"+i)+(n?l+n:""))},fromCents:!1},s=function(t){return Math.round(t)},c=function(t){return Math.pow(10,t)},o=/(\d)(?=(\d{3})+\b)/g,i=/(\d)(?=(\d\d)+\d\b)/g;function R(t,e){if(!(this instanceof R))return new R(t,e);var e=Object.assign({},a,e),r=c(e.precision),t=l(t,e);this.intValue=t,this.value=t/r,e.increment=e.increment||1/r,e.useVedic?e.groups=i:e.groups=o,this.s=e,this.p=r}function l(t,e,r){var r=!(2<arguments.length&&void 0!==r)||r,a=0,o=e.decimal,i=e.errorOnInvalid,l=e.precision,e=e.fromCents,l=c(l),n=t instanceof R;if(n&&e)return t.intValue;if("number"==typeof t||n)a=n?t.value:t;else if("string"==typeof t){n=new RegExp("[^-\\d"+o+"]","g"),o=new RegExp("\\"+o,"g");a=(a=t.replace(/\((.*)\)/,"-$1").replace(n,"").replace(o,"."))||0}else{if(i)throw Error("Invalid Input");a=0}return e||(a=(a*=l).toFixed(4)),r?s(a):a}R.prototype={add:function(t){var e=this.intValue,r=this.s,a=this.p;return R((e+=l(t,r))/(r.fromCents?1:a),r)},subtract:function(t){var e=this.intValue,r=this.s,a=this.p;return R((e-=l(t,r))/(r.fromCents?1:a),r)},multiply:function(t){var e=this.intValue,r=this.s;return R((e*=t)/(r.fromCents?1:c(r.precision)),r)},divide:function(t){var e=this.intValue,r=this.s;return R(e/=l(t,r,!1),r)},distribute:function(t){for(var e=this.intValue,r=this.p,a=this.s,o=[],i=Math[0<=e?"floor":"ceil"](e/t),l=Math.abs(e-i*t),n=a.fromCents?1:r;0!==t;t--){var s=R(i/n,a);0<l--&&(s=s[0<=e?"add":"subtract"](1/n)),o.push(s)}return o},dollars:function(){return~~this.value},cents:function(){return~~(this.intValue%this.p)},format:function(t){var e=this.s;return"function"==typeof t?t(this,e):e.format(this,Object.assign({},e,t))},toString:function(){var t=this.intValue,e=this.p,r=this.s;return t=t/e,e=r.increment,(s(t/e)*e).toFixed(r.precision)},toJSON:function(){return this.value}};return(t={})=>{FlowPlater.config({storage:{enabled:!0}}),FlowPlater.log(FlowPlater.logLevels.INFO,"[CartPlugin] Early config executed: Storage enabled.");const d={name:"cart",enabled:!0,priority:50,version:"1.0.0",dependencies:["data-extractor"],optionalDependencies:[],settings:{debug:!1,dataAttribute:"product",group:"cart",requiredKeys:["id","name"]},description:"Shopping cart functionality for FlowPlater",author:"FlowPlater Team",currency:{name:"USD",symbol:"$",precision:2,separator:",",decimal:".",...t.currency},taxRates:[{name:"VAT",value:1.21}],locale:t.locale||"en-US"},g=(Object.assign(d,t),(t,e)=>{var r=t?.id;if(null==r)return FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Cannot generate cart item ID: Base product ID is missing.",t),null;e=e?E._getRawAttribute(e,"cart-variant-key",null):null;if(!e)return r.toString();e=e.split(",").map(t=>t.trim()).sort();if(0===e.length)return r.toString();var a,o=[];let i=!1;for(const l of e)t.hasOwnProperty(l)&&null!=(a=t[l])&&""!==a&&(i=!0,"string"==typeof a||"number"==typeof a?o.push(encodeURIComponent(l)+"="+encodeURIComponent(a)):FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] Variant key '${l}' has non-primitive value, skipping for ID generation:`,a));return i?r+"::"+o.join(";"):r.toString()}),p={cart:{items:new Map,totalItems:0,totalPrice:0,totalDiscount:0,totalTax:0,totalAmount:0,totalItemsFmt:"",totalPriceFmt:"",totalDiscountFmt:"",totalTaxFmt:"",totalAmountFmt:""},observers:new Map},c=()=>{E.findMatchingElements("data",d.settings.dataAttribute).forEach(e=>{if(!e.closest(`[fp-group="${d.settings.group}"]`)){var r=w(e);if(r){var a=e.querySelector("[fp-cart-add]");const u=g(r,a);var o=p.cart.items.get(u),i=e.querySelector("[fp-cart-item-amount]"),e=e.querySelector("[fp-cart-remove]"),o=o?.amount||0,l=void 0===r.stock||null===r.stock?1/0:r.stock,n=P(r.id),s=l<=n,c=o<=0;if(i&&(i.value=o,i.min="0",o=Math.max(0,l-(n-o)),i.max=o),a){let t=s;if(1===l&&1===n){const m=r.id?.toString();Array.from(p.cart.items.keys()).some(t=>t.split("::")[0]===m&&t!==u)&&(t=!1)}a.disabled=t,a.disabled?a.classList.add("fp-disabled"):a.classList.remove("fp-disabled")}if(e){let t=!c;i=p.cart.items.has(r.id?.toString()),o=u===r.id?.toString();i&&o&&(t=!0),e.disabled=!t,t?e.classList.remove("fp-disabled"):e.classList.add("fp-disabled")}}}}),FlowPlater.trigger("cart:productStatesUpdated",null,{})},a=()=>{return{items:Array.from(p.cart.items.values()).map(t=>({...t,amountFmt:t.amountFmt,unitPriceFmt:t.unitPriceFmt,totalPriceFmt:t.totalPriceFmt,discountFmt:t.discountFmt,totalDiscountFmt:t.totalDiscountFmt,taxFmt:t.taxFmt})),totalItems:p.cart.totalItems,totalItemsFmt:p.cart.totalItemsFmt,totalPrice:p.cart.totalPrice,totalPriceFmt:p.cart.totalPriceFmt,totalDiscount:p.cart.totalDiscount,totalDiscountFmt:p.cart.totalDiscountFmt,totalTax:p.cart.totalTax,totalTaxFmt:p.cart.totalTaxFmt,totalAmount:p.cart.totalAmount,totalAmountFmt:p.cart.totalAmountFmt}},u=t=>{if(t){const e=new Map;Array.isArray(t.items)&&t.items.forEach(t=>{t&&void 0!==t.cartItemId?e.set(t.cartItemId,t):t&&void 0!==t.id&&(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Cart item missing cartItemId during deserialization. Using base id as fallback key.",t),e.set(t.id,t))}),p.cart.items=e,p.cart.totalItems=t.totalItems||0,p.cart.totalPrice=t.totalPrice||0,p.cart.totalDiscount=t.totalDiscount||0,p.cart.totalTax=t.totalTax||0,p.cart.totalAmount=t.totalAmount||0,FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] State after deserializeCart:",p.cart)}else p.cart.items=new Map,p.cart.totalItems=0,p.cart.totalPrice=0,p.cart.totalDiscount=0,p.cart.totalTax=0,p.cart.totalAmount=0,FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] State reset in deserializeCart (no data).")},m=t=>{return E.findClosestParent("data",d.settings.dataAttribute,!0,t)};function f(t){if("number"==typeof t)return t;if(!t)return 0;let e=t.toString().trim();e=e.replace(/[^\d.,\- ]/g,"");try{return R(e,{separator:d.currency.separator,decimal:d.currency.decimal}).value}catch(t){return 0}}const v=(t,e)=>{t=f(t);return e?e.endsWith("%")?t*(1-parseFloat(e)/100):Math.max(0,t-f(e)):t},h=t=>{t=p.cart.items.get(t);return t?t.amount:0},P=e=>{let r=0;return p.cart.items.forEach(t=>{t.cartItemId.split("::")[0]===e.toString()&&(r+=t.amount)}),r},b=()=>{let i=0,l=0,n=0,s=0,e=0;var t=p.cart.totalItems,r=(p.cart.items.forEach(e=>{i+=e.amount;var t=f(e.price)||0,r=e.discount||"0",r=v(t,r),a=r*e.amount,o=a*(d.taxRates.find(t=>t.name.toLowerCase()===e.taxRate?.toLowerCase())?.value||d.taxRates[0].value);l+=t*e.amount,n+=(t-r)*e.amount,s+=o-a}),e=l-n+s,p.cart.totalItems=i,p.cart.totalPrice=l,p.cart.totalDiscount=n,p.cart.totalTax=s,p.cart.totalAmount=e,p.cart.totalItemsFmt=p.cart.totalItems.toString(),p.cart.totalPriceFmt=F(p.cart.totalPrice,{currencySymbol:d.currency.symbol}),p.cart.totalDiscountFmt=F(p.cart.totalDiscount,{currencySymbol:d.currency.symbol}),p.cart.totalTaxFmt=F(p.cart.totalTax,{currencySymbol:d.currency.symbol}),p.cart.totalAmountFmt=F(p.cart.totalAmount,{currencySymbol:d.currency.symbol}),E.findMatchingElements("data",d.settings.dataAttribute).forEach(e=>{if(e.closest(`[fp-group="${d.settings.group}"]`)){const n=w(e);void(n&&(t=Array.from(p.cart.items.values()).find(t=>t.id===n.id&&(!t.cartItemId||t.cartItemId===e.getAttribute("fp-cart-item-id"))))&&t.cartItemId&&e.setAttribute("fp-cart-item-id",t.cartItemId))}else{const n=w(e);var t,r,a,o,i,l;n&&(t=e.querySelector("[fp-cart-add]"),r=e.querySelector("[fp-cart-remove]"),a=e.querySelector("[fp-cart-item-amount]"),o=g(n,t),o=h(o),i=void 0===n.stock||null===n.stock?1/0:n.stock,l=o<=0,t&&(t.disabled=i<=o),r&&(r.disabled=l),a)&&(a.value=o,a.min="0",a.max=i)}}),E.findMatchingElements("cart-total-count").forEach(t=>{t.textContent=i.toString()}),E.findMatchingElements("cart-total-price").forEach(t=>{t.textContent=l.toFixed(2)}),E.findMatchingElements("cart-total-discount").forEach(t=>{t.textContent=n.toFixed(2)}),E.findMatchingElements("cart-total-tax").forEach(t=>{t.textContent=s.toFixed(2)}),E.findMatchingElements("cart-total-amount").forEach(t=>{t.textContent=e.toFixed(2)}),a());FlowPlater.updateGroup(d.settings.group,r),FlowPlater.trigger("cart:updated",null,{cart:p.cart}),document.querySelectorAll(`[fp-group="${d.settings.group}"] [fp-cart-remove]`).forEach(t=>{t.disabled=!1}),c(),t!==i&&FlowPlater.trigger("cart:amountUpdated",null,{oldCount:t,newCount:i})};function F(t,e={}){return"number"!=typeof t||isNaN(t)?"":R(t,{symbol:void 0!==e.currencySymbol?e.currencySymbol:d.currency.symbol||"",separator:d.currency.separator,decimal:d.currency.decimal,precision:void 0!==e.mantissa?e.mantissa:d.currency.precision}).format()}const A=(t,e=null)=>{e=g(t,e);e&&(p.cart.items.delete(e),FlowPlater.trigger("cart:productRemoved",null,{productData:t,cartItemId:e}),b())},o=t=>{var e=d.settings,r=e.variantKey||"variant";const a=e.variantIdKey||"id";var o,e=e.variantSelectorKey||"selected-variant",i=t[r];const l=t[e];return Array.isArray(i)&&0!==i.length?"string"!=typeof l&&"number"!=typeof l?(FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] Invalid or missing value for selector key '${e}'. Expected string or number, got:`,l),delete t[r],t.hasOwnProperty(e)&&delete t[e],t):(i=i.find(t=>t&&t[a]?.toString()===l.toString()))?(delete(o={...t})[r],delete o[e],Object.assign(o,i),FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Variant merged",{baseData:t,selectedVariant:i,mergedData:o}),o):(FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] No variant found with ${a} matching selector value:`,l),delete t[r],t.hasOwnProperty(e)&&delete t[e],t):(t.hasOwnProperty(e)&&delete t[e],t)},w=t=>{FlowPlater.log(FlowPlater.logLevels.INFO,"Processing HTML",t);let e=null;try{e=FlowPlater.getPlugin("data-extractor").instanceMethods.extractData(t)}catch(t){return FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Failed to extract data using DataExtractorPlugin.",t),null}var r;return e&&0!==Object.keys(e).length?(r=e[d.settings.dataAttribute]||e,o(r)):(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Data extraction yielded no data.",t),null)},I=(t,e,r=null)=>{var a,o,i=g(t,r);i&&((a=p.cart.items.get(i))?(o=void 0===a.stock||null===a.stock?1/0:a.stock,0===(e=Math.min(Math.max(0,e),o))?(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Removing item ${i} (newAmount is 0).`),A(t,r)):e!==a.amount?(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Updating item ${i} from ${a.amount} to ${e}.`),a.amount=e,b()):FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Item ${i} amount (${a.amount}) unchanged.`)):FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount called for non-existent item: ${i}. No action taken.`))},y=o=>{var t;p.observers.has(o)||((t=new MutationObserver(t=>{for(const a of t){var e,r;("attributes"===a.type&&E._attributeMatchesNormalizedName(a.attributeName,"data")||"characterData"===a.type&&E._hasAttribute(a.target.parentElement,"data"))&&(e=w(o),r=p.cart.items.get(e.id))&&(Object.assign(r,e),b())}})).observe(o,{attributes:!0,attributeFilter:E._getAllAttributeNames("data"),characterData:!0,subtree:!0}),p.observers.set(o,t))};var t={initComplete:function(t,e){var r=FlowPlater.getOrCreateGroup(d.settings.group,{}),r=(r&&r.data?(FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Calling deserializeCart with group data:",r.data),u(r.data)):(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] No group or group data found in initComplete."),u(null)),E.findMatchingElements("data",d.settings.dataAttribute).forEach(t=>{t=Array.from(t.querySelectorAll('input[type="radio"]'));const e={};t.forEach(t=>{t.name&&(e[t.name]||(e[t.name]=[]),e[t.name].push(t))}),Object.values(e).forEach(t=>{t.some(t=>t.checked)||(t[0].checked=!0)})}),()=>{document.querySelectorAll("[fp-cart-add], [fp-cart-remove], [fp-cart-item-amount]").forEach(t=>{t.removeEventListener("click",l),t.removeEventListener("change",n),t.removeEventListener("input",s)}),document.removeEventListener("click",a),document.removeEventListener("change",o),document.removeEventListener("input",i),document.addEventListener("click",a),document.addEventListener("change",o),document.addEventListener("input",i),c()});const a=e=>{var r=e.target.closest("[fp-cart-add], [fp-cart-remove]");if(r){e.preventDefault(),e.stopPropagation();var e=r.hasAttribute("fp-cart-add"),t=r.hasAttribute("fp-cart-remove");if(e||t){r=m(r);if(r){var a=r.closest(`[fp-group="${d.settings.group}"]`);if(t&&a){let t=r.getAttribute("fp-data-cart-item-id");if(t||(a=w(r))&&(o=Object.keys(a).filter(t=>"id"!==t&&"amount"!==t&&"price"!==t&&"stock"!==t&&"cartItemId"!==t&&!d.settings.requiredKeys.includes(t)),(i=document.createElement("button")).setAttribute("fp-cart-variant-key",o.join(",")),t=g(a,i)),t)return FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Remove button clicked for cart item: "+t),p.cart.items.delete(t),void b()}const c=w(r);if(c){const u=r.querySelector("[fp-cart-add]");var o=u?E._getRawAttribute(u,"cart-variant-key",null):null;if(o){a=o.split(",").map(t=>t.trim()).filter(Boolean);if(a.some(t=>!c[t]))return FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Cannot add to cart: Not all variant options are selected.",{variantKeys:a,productData:c}),u.classList.add("fp-variant-missing"),void setTimeout(()=>u.classList.remove("fp-variant-missing"),1e3)}if(e){var i=r.querySelector("[fp-cart-item-amount]");let t=1;i&&(o=parseInt(i.value),!isNaN(o))&&0<o&&(t=o);var a=g(c,u),[l,e=1,i=null]=(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Add button clicked for ${a}, amount from input: `+t),[c,t,u]),o=d.settings.requiredKeys.filter(t=>!(t in l)).join(", ");if(o)FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Product missing required fields: "+o);else{o=g(l,i);if(o){var i=p.cart.items.get(o),a=void 0===l.stock||null===l.stock?1/0:l.stock,n=P(l.id);if(1===a&&1===n&&!i){let r=null;if(p.cart.items.forEach((t,e)=>{e.split("::")[0]===l.id.toString()&&(r=e)}),r)return void(s=p.cart.items.get(r),p.cart.items.delete(r),p.cart.items.set(o,{...l,cartItemId:o,amount:1,amountFmt:R(1).format({thousandSeparated:!0}),unitPrice:s.price,unitPriceFmt:F(s.price),totalPrice:s.price,totalPriceFmt:F(s.price),discount:s.discount,discountFmt:F(s.discount),totalDiscount:+s.discount,totalDiscountFmt:F(+s.discount),tax:s.tax,taxFmt:F(s.tax),taxRate:s.taxRate||d.taxRates[0].name}),FlowPlater.log(FlowPlater.logLevels.INFO,`[CartPlugin] Replaced variant ${r} with ${o} (stock: 1)`),FlowPlater.trigger("cart:variantReplaced",null,{oldVariantId:r,newVariantId:o,product:l}),b())}var s=Math.max(0,a-n);if(i){a=i.amount,n=Math.min(a+e,a+s);if(n===a)return;i.amount=n}else{a=Math.min(e,s);if(a<=0)return;i=f(l.price)||0,n=f(l.discount)||"0",e=d.taxRates.find(t=>t.name.toLowerCase()===l.taxRate?.toLowerCase())?.value||d.taxRates[0].value;p.cart.items.set(o,{...l,cartItemId:o,amount:a,amountFmt:a.toString(),unitPrice:i,unitPriceFmt:F(i),totalPrice:i*a,totalPriceFmt:F(i*a),discount:n,discountFmt:F(n),totalDiscount:n*a,totalDiscountFmt:F(n*a),tax:(i*a-n*a)*(e-1),taxFmt:F((i*a-n*a)*(e-1)),taxRate:l.taxRate||d.taxRates[0].name}),FlowPlater.trigger("cart:productAdded",null,{product:l,cartItemId:o})}b()}}}else t&&(s=g(c,u),FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Remove button clicked for product: "+s),A(c,u))}else FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Could not extract product data.",{element:r})}}}},o=t=>{var e=t.target.closest("[fp-cart-item-amount]");if(e){t.preventDefault(),t.stopPropagation();const i=m(e);if(i){var r=w(i);if(!r)return void FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Could not extract product data on change.",{element:i});var a=i.querySelector("[fp-cart-add]"),o=g(r,a);FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Input changed for ${o}, new value: `+e.value),I(r,parseInt(e.value)||0,a)}}else{const i=m(t.target);i&&c()}},i=t=>{var e,r,a,t=t.target.closest("[fp-cart-item-amount]");t&&(r=m(t))&&(e=w(r))&&(r=r.querySelector("[fp-cart-add]"),a=g(e,r),FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Input changed for ${a}, new value: `+t.value),I(e,parseInt(t.value)||0,r))},l=()=>{},n=()=>{},s=()=>{};return r(),FlowPlater.on("afterDomUpdate",r),E.findMatchingElements("data",d.settings.dataAttribute).forEach(y),b(),d.settings.debug&&FlowPlater.log(FlowPlater.logLevels.INFO,"[CartPlugin] Initialized successfully"),t}},e=o=>{return Array.from(p.cart.items.values()).map(e=>{let r;if(Array.isArray(o)&&0<o.length)r=o;else{var a=e.cartItemId||"";let t=[];a.includes("::")&&(a=a.split("::")[1],t=a.split(";").map(t=>decodeURIComponent(t.split("=")[0])).filter(Boolean)),r=[...t,"price"]}let t="";return(t=0<r.length?r.filter(t=>t in e).map(t=>t+": "+e[t]).join(", "):t)?`${e.name} (${t})`:e.name}).join(", ")};return"function"!=typeof FlowPlater.getCartItemsAsString&&(FlowPlater.getCartItemsAsString=e),{config:d,state:p,hooks:t,globalMethods:{getCartItemsAsString:e}}}}();