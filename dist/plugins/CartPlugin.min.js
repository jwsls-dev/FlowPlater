var CartPlugin=function(){"use strict";const n={level:1,levels:{ERROR:0,WARN:1,INFO:2,DEBUG:3},log:function(t){this.level},error:function(...t){this.log(this.levels.ERROR,...t)},warn:function(...t){this.log(this.levels.WARN,...t)},info:function(...t){this.log(this.levels.INFO,...t)},debug:function(...t){this.log(this.levels.DEBUG,...t)}},I={INHERITABLE_ATTRIBUTES:{"hx-":["boost","push-url","select","select-oob","swap","target","vals","confirm","disable","disabled-elt","encoding","ext","headers","include","indicator","params","prompt","replace-url","request","sync","vars"],"fp-":["prepend","append","persist","target"]},_prefixes(){return Object.keys(this.INHERITABLE_ATTRIBUTES)},_normalizeAttributeName(t){return t.replace(/^(hx-|fp-)/,"").replace(/^data-/,"")},_getAllAttributeNames(t){var e=this._normalizeAttributeName(t),r=[];for(const a of this._prefixes())r.push(""+a+e),r.push("data-"+a+e);return r},_getRawAttribute(t,e,r=null){for(const i of this._getAllAttributeNames(e)){var a=t.getAttribute(i);if(null!==a)return a}return r},_hasAttribute(e,t){return this._getAllAttributeNames(t).some(t=>e.hasAttribute(t))},findMatchingElements(t,e=null,r=!0,a=document,i=!0,o=!1){var l=this._getAllAttributeNames(t);let n=l.map(t=>`[${t}]`).join(",");if(null!=e){const s=r?`="${e}"`:`*="${e}"`;n=l.map(t=>`[${t}${s}]`).join(",")}l=Array.from(a.querySelectorAll(n));return i&&a instanceof Element&&(null===(i=this._getRawAttribute(a,t))||null!=e&&(r?i!==e:!i.includes(e))||l.unshift(a)),null!=e&&o?l[0]:l},findClosestParent(t,e,r=null,a=!0){if(!t)return n.error("Attribute name is required"),null;if(!e)return n.error("Element is required to find closest parent ("+t+")"),null;var t=this._normalizeAttributeName(t),i=this._getAllAttributeNames(t);let o=i.map(t=>`[${t}]`).join(",");if(null!=r){const l=a?`="${r}"`:`*="${r}"`;o=i.map(t=>`[${t}${l}]`).join(",")}a=e.closest(o);if(a&&this.isInheritable(t)){r=this._getRawAttribute(a,"disinherit");if(r&&("*"===r||r.split(" ").includes(t)))return null}return a},getElementWithAttribute(t,e=document,r=!0){return r&&e instanceof Element&&this._hasAttribute(e,t)?e:(r=this._getAllAttributeNames(t).map(t=>`[${t}]`).join(","),e.querySelector(r))},_parentElement(t){var e=t.parentElement;return!e&&t.parentNode instanceof ShadowRoot?t.parentNode:e},_getRootNode(t,e=!1){return t.getRootNode?t.getRootNode({composed:e}):document},_getClosestMatch(t,e){for(;t&&!e(t);)t=this._parentElement(t);return t||null},_attributeMatchesNormalizedName(t,e){return t.replace(/^data-/,"").replace(/^hx-/,"").replace(/^fp-/,"")===e},_getAttributeValueWithInheritance(t,e,r){var a=this._getRawAttribute(e,r),i=this._getRawAttribute(e,"disinherit"),o=this._getRawAttribute(e,"inherit");if(t!==e){if(htmx.config.disableInheritance)return o&&("*"===o||o.split(" ").includes(r))?a:null;if(i&&("*"===i||i.split(" ").includes(r)))return"unset"}return a},findInheritedAttribute(e,t){const r=this._normalizeAttributeName(t);let a=null;return this._getClosestMatch(e,t=>{t=this._getAttributeValueWithInheritance(e,t,r);return!!t&&(a=t,!0)}),"unset"===a?null:a},findAttribute(t,e){var r=this._normalizeAttributeName(e);for(const i of this._prefixes()){var a=this._getRawAttribute(t,""+i+r);if(a)return a}return this.findInheritedAttribute(t,r)||null},_validateAttributeName(t){return t?!!this.isInheritable(t)||(n.info(`Attribute ${t} is not inheritable`),!1):(n.error("Attribute name is required"),!1)},addInheritableAttribute(t,e){this.INHERITABLE_ATTRIBUTES[t]||(this.INHERITABLE_ATTRIBUTES[t]=[]),this.INHERITABLE_ATTRIBUTES[t].push(e)},removeInheritableAttribute(t,e){return!!this.INHERITABLE_ATTRIBUTES[t]&&-1!==(e=this.INHERITABLE_ATTRIBUTES[t].indexOf(e))&&(this.INHERITABLE_ATTRIBUTES[t].splice(e,1),!0)},isInheritable(t){t=this._normalizeAttributeName(t);return Object.values(this.INHERITABLE_ATTRIBUTES).flat().includes(t)}};var a={symbol:"$",separator:",",decimal:".",errorOnInvalid:!1,precision:2,pattern:"!#",negativePattern:"-!#",format:function(t,e){var r=e.pattern,a=e.negativePattern,i=e.symbol,o=e.separator,l=e.decimal,e=e.groups,n=(""+t).replace(/^-/,"").split("."),s=n[0],n=n[1];return(0<=t.value?r:a).replace("!",i).replace("#",s.replace(e,"$1"+o)+(n?l+n:""))},fromCents:!1},s=function(t){return Math.round(t)},c=function(t){return Math.pow(10,t)},i=/(\d)(?=(\d{3})+\b)/g,o=/(\d)(?=(\d\d)+\d\b)/g;function E(t,e){if(!(this instanceof E))return new E(t,e);var e=Object.assign({},a,e),r=c(e.precision),t=l(t,e);this.intValue=t,this.value=t/r,e.increment=e.increment||1/r,e.useVedic?e.groups=o:e.groups=i,this.s=e,this.p=r}function l(t,e,r){var r=!(2<arguments.length&&void 0!==r)||r,a=0,i=e.decimal,o=e.errorOnInvalid,l=e.precision,e=e.fromCents,l=c(l),n=t instanceof E;if(n&&e)return t.intValue;if("number"==typeof t||n)a=n?t.value:t;else if("string"==typeof t){n=new RegExp("[^-\\d"+i+"]","g"),i=new RegExp("\\"+i,"g");a=(a=t.replace(/\((.*)\)/,"-$1").replace(n,"").replace(i,"."))||0}else{if(o)throw Error("Invalid Input");a=0}return e||(a=(a*=l).toFixed(4)),r?s(a):a}E.prototype={add:function(t){var e=this.intValue,r=this.s,a=this.p;return E((e+=l(t,r))/(r.fromCents?1:a),r)},subtract:function(t){var e=this.intValue,r=this.s,a=this.p;return E((e-=l(t,r))/(r.fromCents?1:a),r)},multiply:function(t){var e=this.intValue,r=this.s;return E((e*=t)/(r.fromCents?1:c(r.precision)),r)},divide:function(t){var e=this.intValue,r=this.s;return E(e/=l(t,r,!1),r)},distribute:function(t){for(var e=this.intValue,r=this.p,a=this.s,i=[],o=Math[0<=e?"floor":"ceil"](e/t),l=Math.abs(e-o*t),n=a.fromCents?1:r;0!==t;t--){var s=E(o/n,a);0<l--&&(s=s[0<=e?"add":"subtract"](1/n)),i.push(s)}return i},dollars:function(){return~~this.value},cents:function(){return~~(this.intValue%this.p)},format:function(t){var e=this.s;return"function"==typeof t?t(this,e):e.format(this,Object.assign({},e,t))},toString:function(){var t=this.intValue,e=this.p,r=this.s;return t=t/e,e=r.increment,(s(t/e)*e).toFixed(r.precision)},toJSON:function(){return this.value}};return(t={})=>{FlowPlater.config({storage:{enabled:!0}}),FlowPlater.log(FlowPlater.logLevels.INFO,"[CartPlugin] Early config executed: Storage enabled.");const d={name:"cart",enabled:!0,priority:50,version:"1.0.0",dependencies:["data-extractor"],optionalDependencies:[],settings:{debug:!1,dataAttribute:"product",group:"cart",requiredKeys:["id","name"]},description:"Shopping cart functionality for FlowPlater",author:"FlowPlater Team",currency:{name:"USD",symbol:"$",precision:2,separator:",",decimal:".",...t.currency},taxRates:[{name:"VAT",value:1.21}],locale:t.locale||"en-US"},g=(Object.assign(d,t),(t,e)=>{var r=t?.id;if(null==r)return FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Cannot generate cart item ID: Base product ID is missing.",t),null;e=e?I._getRawAttribute(e,"cart-variant-key",null):null;if(!e)return r.toString();e=e.split(",").map(t=>t.trim()).sort();if(0===e.length)return r.toString();var a,i=[];let o=!1;for(const l of e)t.hasOwnProperty(l)&&null!=(a=t[l])&&""!==a&&(o=!0,"string"==typeof a||"number"==typeof a?i.push(encodeURIComponent(l)+"="+encodeURIComponent(a)):FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] Variant key '${l}' has non-primitive value, skipping for ID generation:`,a));return o?r+"::"+i.join(";"):r.toString()}),p={cart:{items:new Map,totalItems:0,totalPrice:0,totalDiscount:0,totalTax:0,totalAmount:0,totalItemsFmt:"",totalPriceFmt:"",totalDiscountFmt:"",totalTaxFmt:"",totalAmountFmt:""},observers:new Map},c=()=>{var t=I.findMatchingElements("data",d.settings.dataAttribute);(Array.isArray(t)?t:t?[t]:[]).forEach(e=>{if(!e.closest(`[fp-group="${d.settings.group}"]`)){var r=y(e);if(r){var a=e.querySelector("[fp-cart-add]");const u=g(r,a);var i=p.cart.items.get(u),o=e.querySelector("[fp-cart-item-amount]"),e=e.querySelector("[fp-cart-remove]"),i=i?.amount||0,l=void 0===r.stock||null===r.stock?1/0:r.stock,n=A(r.id),s=l<=n,c=i<=0;if(o&&(o.value=i,o.min="0",i=Math.max(0,l-(n-i)),o.max=i),a){let t=s;if(1===l&&1===n){const m=r.id?.toString();Array.from(p.cart.items.keys()).some(t=>t.split("::")[0]===m&&t!==u)&&(t=!1)}a.disabled=t,a.disabled?a.classList.add("fp-disabled"):a.classList.remove("fp-disabled")}if(e){let t=!c;o=p.cart.items.has(r.id?.toString()),i=u===r.id?.toString();o&&i&&(t=!0),e.disabled=!t,t?e.classList.remove("fp-disabled"):e.classList.add("fp-disabled")}}}}),FlowPlater.trigger("cart:productStatesUpdated",null,{})},a=()=>{return{items:Array.from(p.cart.items.values()).map(t=>({...t,amountFmt:t.amountFmt,unitPriceFmt:t.unitPriceFmt,totalPriceFmt:t.totalPriceFmt,discountFmt:t.discountFmt,totalDiscountFmt:t.totalDiscountFmt,taxFmt:t.taxFmt})),totalItems:p.cart.totalItems,totalItemsFmt:p.cart.totalItemsFmt,totalPrice:p.cart.totalPrice,totalPriceFmt:p.cart.totalPriceFmt,totalDiscount:p.cart.totalDiscount,totalDiscountFmt:p.cart.totalDiscountFmt,totalTax:p.cart.totalTax,totalTaxFmt:p.cart.totalTaxFmt,totalAmount:p.cart.totalAmount,totalAmountFmt:p.cart.totalAmountFmt}},u=t=>{if(t){const e=new Map;Array.isArray(t.items)&&t.items.forEach(t=>{t&&void 0!==t.cartItemId?e.set(t.cartItemId,t):t&&void 0!==t.id&&(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Cart item missing cartItemId during deserialization. Using base id as fallback key.",t),e.set(t.id,t))}),p.cart.items=e,p.cart.totalItems=t.totalItems||0,p.cart.totalPrice=t.totalPrice||0,p.cart.totalDiscount=t.totalDiscount||0,p.cart.totalTax=t.totalTax||0,p.cart.totalAmount=t.totalAmount||0,FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] State after deserializeCart:",p.cart)}else p.cart.items=new Map,p.cart.totalItems=0,p.cart.totalPrice=0,p.cart.totalDiscount=0,p.cart.totalTax=0,p.cart.totalAmount=0,FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] State reset in deserializeCart (no data).")},m=t=>{return I.findClosestParent("data",t,d.settings.dataAttribute,!0)};function f(t){if("number"==typeof t)return t;if(!t)return 0;let e=t.toString().trim();e=e.replace(/[^\d.,\- ]/g,"");try{return E(e,{separator:d.currency.separator,decimal:d.currency.decimal}).value}catch(t){return 0}}const v=(t,e)=>{t=f(t);return e?"string"==typeof e&&e.endsWith("%")?t*(1-parseFloat(e)/100):Math.max(0,t-f(e)):t},h=t=>{t=p.cart.items.get(t);return t?t.amount:0},A=e=>{let r=0;return p.cart.items.forEach(t=>{t.cartItemId.split("::")[0]===e.toString()&&(r+=t.amount)}),r},P=()=>{let o=0,l=0,n=0,s=0,e=0;var t=p.cart.totalItems,r=(p.cart.items.forEach(e=>{o+=e.amount;var t=f(e.price)||0,r=e.discount||"0",r=v(t,r),a=r*e.amount,i=a*(d.taxRates.find(t=>t.name.toLowerCase()===e.taxRate?.toLowerCase())?.value||d.taxRates[0].value);l+=t*e.amount,n+=(t-r)*e.amount,s+=i-a}),e=l-n+s,p.cart.totalItems=o,p.cart.totalPrice=l,p.cart.totalDiscount=n,p.cart.totalTax=s,p.cart.totalAmount=e,p.cart.totalItemsFmt=p.cart.totalItems.toString(),p.cart.totalPriceFmt=b(p.cart.totalPrice,{currencySymbol:d.currency.symbol}),p.cart.totalDiscountFmt=b(p.cart.totalDiscount,{currencySymbol:d.currency.symbol}),p.cart.totalTaxFmt=b(p.cart.totalTax,{currencySymbol:d.currency.symbol}),p.cart.totalAmountFmt=b(p.cart.totalAmount,{currencySymbol:d.currency.symbol}),I.findMatchingElements("data",d.settings.dataAttribute)),r=((Array.isArray(r)?r:r?[r]:[]).forEach(e=>{if(e.closest(`[fp-group="${d.settings.group}"]`)){const n=y(e);void(n&&(t=Array.from(p.cart.items.values()).find(t=>t.id===n.id&&(!t.cartItemId||t.cartItemId===e.getAttribute("fp-cart-item-id"))))&&t.cartItemId&&e.setAttribute("fp-cart-item-id",t.cartItemId))}else{const n=y(e);var t,r,a,i,o,l;n&&(t=e.querySelector("[fp-cart-add]"),r=e.querySelector("[fp-cart-remove]"),a=e.querySelector("[fp-cart-item-amount]"),i=g(n,t),i=h(i),o=void 0===n.stock||null===n.stock?1/0:n.stock,l=i<=0,t&&(t.disabled=o<=i),r&&(r.disabled=l),a)&&(a.value=i,a.min="0",a.max=o)}}),I.findMatchingElements("cart-total-count")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=o.toString()}),I.findMatchingElements("cart-total-price")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=l.toFixed(2)}),I.findMatchingElements("cart-total-discount")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=n.toFixed(2)}),I.findMatchingElements("cart-total-tax")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=s.toFixed(2)}),I.findMatchingElements("cart-total-amount")),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t.textContent=e.toFixed(2)}),a());FlowPlater.updateGroup(d.settings.group,r),FlowPlater.trigger("cart:updated",null,{cart:p.cart}),document.querySelectorAll(`[fp-group="${d.settings.group}"] [fp-cart-remove]`).forEach(t=>{t.disabled=!1}),c(),t!==o&&FlowPlater.trigger("cart:amountUpdated",null,{oldCount:t,newCount:o})};function b(t,e={}){return"number"!=typeof t||isNaN(t)?"":E(t,{symbol:void 0!==e.currencySymbol?e.currencySymbol:d.currency.symbol||"",separator:d.currency.separator,decimal:d.currency.decimal,precision:void 0!==e.mantissa?e.mantissa:d.currency.precision}).format()}const F=(t,e=null)=>{e=g(t,e);e&&(p.cart.items.delete(e),FlowPlater.trigger("cart:productRemoved",null,{productData:t,cartItemId:e}),P())},i=t=>{var e=d.settings,r=e.variantKey||"variant";const a=e.variantIdKey||"id";var i,e=e.variantSelectorKey||"selected-variant",o=t[r];const l=t[e];return Array.isArray(o)&&0!==o.length?"string"!=typeof l&&"number"!=typeof l?(FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] Invalid or missing value for selector key '${e}'. Expected string or number, got:`,l),delete t[r],t.hasOwnProperty(e)&&delete t[e],t):(o=o.find(t=>t&&t[a]?.toString()===l.toString()))?(delete(i={...t})[r],delete i[e],Object.assign(i,o),FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Variant merged",{baseData:t,selectedVariant:o,mergedData:i}),i):(FlowPlater.log(FlowPlater.logLevels.WARN,`[CartPlugin] No variant found with ${a} matching selector value:`,l),delete t[r],t.hasOwnProperty(e)&&delete t[e],t):(t.hasOwnProperty(e)&&delete t[e],t)},y=t=>{FlowPlater.log(FlowPlater.logLevels.INFO,"Processing HTML",t);let e=null;try{e=FlowPlater.getPlugin("data-extractor").instanceMethods.extractData(t)}catch(t){return FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Failed to extract data using DataExtractorPlugin.",t),null}var r;return e&&0!==Object.keys(e).length?(r=e[d.settings.dataAttribute]||e,i(r)):(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Data extraction yielded no data.",t),null)},w=(t,e,r=null)=>{var a,i,o=g(t,r);o&&((a=p.cart.items.get(o))?(i=void 0===a.stock||null===a.stock?1/0:a.stock,0===(e=Math.min(Math.max(0,e),i))?(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Removing item ${o} (newAmount is 0).`),F(t,r)):e!==a.amount?(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Updating item ${o} from ${a.amount} to ${e}.`),a.amount=e,P()):FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount: Item ${o} amount (${a.amount}) unchanged.`)):FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] updateAmount called for non-existent item: ${o}. No action taken.`))};var t={initComplete:function(t,e){var r=FlowPlater.getOrCreateGroup(d.settings.group,{}),r=(r&&r.data?(FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Calling deserializeCart with group data:",r.data),u(r.data)):(FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] No group or group data found in initComplete."),u(null)),I.findMatchingElements("data",d.settings.dataAttribute)),r=((Array.isArray(r)?r:r?[r]:[]).forEach(t=>{t=Array.from(t.querySelectorAll('input[type="radio"]'));const e={};t.forEach(t=>{t.name&&(e[t.name]||(e[t.name]=[]),e[t.name].push(t))}),Object.values(e).forEach(t=>{t.some(t=>t.checked)||(t[0].checked=!0)})}),()=>{document.querySelectorAll("[fp-cart-add], [fp-cart-remove], [fp-cart-item-amount]").forEach(t=>{t.removeEventListener("click",l),t.removeEventListener("change",n),t.removeEventListener("input",s)}),document.removeEventListener("click",a),document.removeEventListener("change",i),document.removeEventListener("input",o),document.addEventListener("click",a),document.addEventListener("change",i),document.addEventListener("input",o),c()});const a=e=>{var r=e.target.closest("[fp-cart-add], [fp-cart-remove]");if(r){e.preventDefault(),e.stopPropagation();var e=r.hasAttribute("fp-cart-add"),t=r.hasAttribute("fp-cart-remove");if(e||t){r=m(r);if(r){var a=r.closest(`[fp-group="${d.settings.group}"]`);if(t&&a){let t=r.getAttribute("fp-data-cart-item-id");if(t||(a=y(r))&&(i=Object.keys(a).filter(t=>"id"!==t&&"amount"!==t&&"price"!==t&&"stock"!==t&&"cartItemId"!==t&&!d.settings.requiredKeys.includes(t)),(o=document.createElement("button")).setAttribute("fp-cart-variant-key",i.join(",")),t=g(a,o)),t)return FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Remove button clicked for cart item: "+t),p.cart.items.delete(t),void P()}const c=y(r);if(c){const u=r.querySelector("[fp-cart-add]");var i=u?I._getRawAttribute(u,"cart-variant-key",null):null;if(i){a=i.split(",").map(t=>t.trim()).filter(Boolean);if(a.some(t=>!c[t]))return FlowPlater.log(FlowPlater.logLevels.WARN,"[CartPlugin] Cannot add to cart: Not all variant options are selected.",{variantKeys:a,productData:c}),u.classList.add("fp-variant-missing"),void setTimeout(()=>u.classList.remove("fp-variant-missing"),1e3)}if(e){var o=r.querySelector("[fp-cart-item-amount]");let t=1;o&&(i=parseInt(o.value),!isNaN(i))&&0<i&&(t=i);var a=g(c,u),[l,e=1,o=null]=(FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Add button clicked for ${a}, amount from input: `+t),[c,t,u]),i=d.settings.requiredKeys.filter(t=>!(t in l)).join(", ");if(i)FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Product missing required fields: "+i);else{i=g(l,o);if(i){var o=p.cart.items.get(i),a=void 0===l.stock||null===l.stock?1/0:l.stock,n=A(l.id);if(1===a&&1===n&&!o){let r=null;if(p.cart.items.forEach((t,e)=>{e.split("::")[0]===l.id.toString()&&(r=e)}),r)return void(s=p.cart.items.get(r),p.cart.items.delete(r),p.cart.items.set(i,{...l,cartItemId:i,amount:1,amountFmt:E(1).format(),unitPrice:s.price,unitPriceFmt:b(s.price),totalPrice:s.price,totalPriceFmt:b(s.price),discount:s.discount,discountFmt:b(s.discount),totalDiscount:+s.discount,totalDiscountFmt:b(+s.discount),tax:s.tax,taxFmt:b(s.tax),taxRate:s.taxRate||d.taxRates[0].name}),FlowPlater.log(FlowPlater.logLevels.INFO,`[CartPlugin] Replaced variant ${r} with ${i} (stock: 1)`),FlowPlater.trigger("cart:variantReplaced",null,{oldVariantId:r,newVariantId:i,product:l}),P())}var s=Math.max(0,a-n);if(o){a=o.amount,n=Math.min(a+e,a+s);if(n===a)return;o.amount=n}else{a=Math.min(e,s);if(a<=0)return;o=f(l.price)||0,n=f(l.discount)||0,e=d.taxRates.find(t=>t.name.toLowerCase()===l.taxRate?.toLowerCase())?.value||d.taxRates[0].value;p.cart.items.set(i,{...l,cartItemId:i,amount:a,amountFmt:a.toString(),unitPrice:o,unitPriceFmt:b(o),totalPrice:o*a,totalPriceFmt:b(o*a),discount:n,discountFmt:b(n),totalDiscount:n*a,totalDiscountFmt:b(n*a),tax:(o*a-n*a)*(e-1),taxFmt:b((o*a-n*a)*(e-1)),taxRate:l.taxRate||d.taxRates[0].name}),FlowPlater.trigger("cart:productAdded",null,{product:l,cartItemId:i})}P()}}}else t&&(s=g(c,u),FlowPlater.log(FlowPlater.logLevels.DEBUG,"[CartPlugin] Remove button clicked for product: "+s),F(c,u))}else FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Could not extract product data.",{element:r})}}}},i=t=>{var e=t.target.closest("[fp-cart-item-amount]");if(e){t.preventDefault(),t.stopPropagation();const o=m(e);if(o){var r=y(o);if(!r)return void FlowPlater.log(FlowPlater.logLevels.ERROR,"[CartPlugin] Could not extract product data on change.",{element:o});var a=o.querySelector("[fp-cart-add]"),i=g(r,a);FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Input changed for ${i}, new value: `+e.value),w(r,parseInt(e.value)||0,a)}}else{const o=m(t.target);o&&c()}},o=t=>{var e,r,a,t=t.target.closest("[fp-cart-item-amount]");t&&(r=m(t))&&(e=y(r))&&(r=r.querySelector("[fp-cart-add]"),a=g(e,r),FlowPlater.log(FlowPlater.logLevels.DEBUG,`[CartPlugin] Input changed for ${a}, new value: `+t.value),w(e,parseInt(t.value)||0,r))},l=()=>{},n=()=>{},s=()=>{};r(),FlowPlater.on("afterDomUpdate",r);r=I.findMatchingElements("data",d.settings.dataAttribute);return(Array.isArray(r)?r:r?[r]:[]).forEach(t=>{var i;i=t,p.observers.has(i)||((t=new MutationObserver(t=>{for(const a of t){var e,r;("attributes"===a.type&&I._attributeMatchesNormalizedName(a.attributeName,"data")||"characterData"===a.type&&I._hasAttribute(a.target.parentElement,"data"))&&(e=y(i),r=p.cart.items.get(e.id))&&(Object.assign(r,e),P())}})).observe(i,{attributes:!0,attributeFilter:I._getAllAttributeNames("data"),characterData:!0,subtree:!0}),p.observers.set(i,t))}),P(),d.settings.debug&&FlowPlater.log(FlowPlater.logLevels.INFO,"[CartPlugin] Initialized successfully"),t}},e=i=>{return Array.from(p.cart.items.values()).map(e=>{let r;if(Array.isArray(i)&&0<i.length)r=i;else{var a=e.cartItemId||"";let t=[];a.includes("::")&&(a=a.split("::")[1],t=a.split(";").map(t=>decodeURIComponent(t.split("=")[0])).filter(Boolean)),r=[...t,"price"]}let t="";return(t=0<r.length?r.filter(t=>t in e).map(t=>t+": "+e[t]).join(", "):t)?`${e.name} (${t})`:e.name}).join(", ")};return"function"!=typeof FlowPlater.getCartItemsAsString&&(FlowPlater.getCartItemsAsString=e),{config:d,state:p,hooks:t,globalMethods:{getCartItemsAsString:e}}}}();